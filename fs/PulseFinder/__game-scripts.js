var GameMgr=pc.createScript("gameManager");GameMgr.attributes.add("trackAlternateFrames",{type:"boolean",default:!1,title:"Track Alternate Frames",description:"If selected, tracking is only performed on every other update. This can increase lag in tracking but will reduce CPU load."}),GameMgr.attributes.add("HearthBeatMgr",{type:"entity"}),GameMgr.attributes.add("ScreenResolutionText",{type:"entity"}),GameMgr.attributes.add("TimeText",{type:"entity"}),GameMgr.attributes.add("PulseText",{type:"entity"}),GameMgr.attributes.add("BpmText",{type:"entity"}),GameMgr.attributes.add("ScanWindowWidth",{type:"number",default:50}),GameMgr.attributes.add("ScanWindowHeight",{type:"number",default:50}),GameMgr.attributes.add("MiniWindowWidth",{type:"number",default:300}),GameMgr.attributes.add("MiniWindowHeight",{type:"number",default:300}),GameMgr.attributes.add("ArrayMaxCount",{type:"number",default:100}),GameMgr.attributes.add("BeatZone",{type:"number",default:.5}),GameMgr.attributes.add("OutBeatZoneRange",{type:"number",default:2}),GameMgr.attributes.add("MinFramesForSound",{type:"number",default:5}),GameMgr.attributes.add("weight",{type:"number",default:.5,min:0,max:1,title:"Weight",description:"Sensitivity, control shakiness"}),GameMgr.attributes.add("GrayMode",{type:"boolean",default:!0}),GameMgr.attributes.add("DisplaySmooth",{type:"boolean",default:!1}),GameMgr.prototype.initialize=function(){var e=this.app,t=this;e.addTweenManager(),this.process=!0,this.openCVReady=!1,this.timer=0,this.posArray=[],this.timeArray=[],this.weightInv=1-this.weight,this.oldLum=0,this.goingUp=!1,this.goingDown=!1,this.framesForSound=0,this.canPlaySound=!0,this.BeatRangeFound=!1,this.isBeatZone=!1,this.beatCount=0,this.timeStart=0,this.supportsVideoMode()&&this.enterVideoMode(),e.on("game:beatAnimate",(function(){this.beatCount++,this.canPlaySound&&(this.app.fire("heart:pulse"),this.entity.sound.play("beat"),this.canPlaySound=!1,setTimeout((function(){t.canPlaySound=!0}),100))}),this)},GameMgr.prototype.update=function(e){TWEEN.update(),this.timer+=e,this.openCVReady&&(this.cap.read(this.src),this.trackAlternateFrames?(this.process&&this.render(),this.process=!this.process):this.render()),this.texture&&this.texture.upload()},GameMgr.prototype.render=function(){this.CheckHeartBeat()},GameMgr.prototype.CheckHeartBeat=function(){cv.cvtColor(this.src,this.dst,this.GrayMode?cv.COLOR_RGB2GRAY:cv.COLOR_RGB2HSV),this.dst2=this.dst.roi(this.rect),cv.medianBlur(this.dst2,this.dst3,15);var e=cv.mean(this.dst3)[this.GrayMode?0:2];this.DisplaySmooth?(cv.resize(this.dst3,this.dst3,this.outputSize,0,0,cv.INTER_AREA),cv.imshow("output",this.dst3)):(cv.resize(this.dst2,this.dst2,this.outputSize,0,0,cv.INTER_AREA),cv.imshow("output",this.dst2));var t=e,i=(t*=this.weight)+this.oldLum*this.weightInv;if(this.BeatRangeFound){var a=this.timer-this.timeStart;this.BpmText.element.text=(Math.round(60*this.beatCount/a*100)/100).toFixed(0)+" BPM";var s=i<=this.highest,o=i>=this.lowest;s&&o||(o?(this.BeatRangeFound=i-this.highest<=this.OutBeatZoneRange,this.BeatRangeFound||(i=this.highest,this.beatCount=0)):s&&(this.BeatRangeFound=this.lowest-i<=this.OutBeatZoneRange,this.BeatRangeFound||(i=this.lowest,this.beatCount=0)))}this.posArray.length>=this.ArrayMaxCount&&(this.posArray.shift(),this.timeArray.shift()),this.posArray.push(i),this.timeArray.push(this.timer);var n=(Math.round(100*i)/100).toFixed(2),r=(Math.round(100*this.highest)/100).toFixed(2),d=(Math.round(100*this.lowest)/100).toFixed(2);this.checkFlow(i,this.oldLum),this.oldLum=i,this.HearthBeatMgr.script.heartBeatRenderer.setArrays(this.posArray,this.timeArray,this.lowest,this.highest,this.OutBeatZoneRange),this.TimeText.element.text=(Math.round(100*this.timer)/100).toFixed(2)+"sec",this.PulseText.element.text="Avg. Luminosity : "+n+"\nHigh range : "+r+"\nLow range : "+d+(this.isBeatZone?"\n\n    Looking for Pulse":"\n\n   Gathering Data")},GameMgr.prototype.checkFlow=function(e,t){if(e>=t?(this.goingUp&&++this.framesForSound,this.goingUp=!0,this.goingDown=!1):(this.isBeatZone&&this.goingUp&&this.framesForSound>=this.MinFramesForSound&&this.app.fire("game:beatAnimate"),this.framesForSound=0,this.goingUp=!1,this.goingDown=!0),!this.BeatRangeFound){this.lowest=255,this.highest=0;for(var i=0;i<this.posArray.length;++i){var a=this.posArray[i];a<this.lowest&&(this.lowest=a),a>this.highest&&(this.highest=a)}}this.BeatRangeFound||this.posArray.length<90||(this.isBeatZone=this.highest-this.lowest<=this.BeatZone,this.isBeatZone&&(this.timeStart=this.timer,this.BeatRangeFound=!0))},GameMgr.prototype.startOpenCV=function(){var e=this,t=document.createElement("script");t.onload=function(){console.log("OpenCV loaded and ready"),cv.onRuntimeInitialized=function(){e.video.width=e.video.videoWidth,e.video.height=e.video.videoHeight;var t=e.video.width,i=e.video.height;e.cap=new cv.VideoCapture(e.video),e.src=new cv.Mat(i,t,cv.CV_8UC4),e.dst=new cv.Mat(i,t,e.GrayMode?cv.CV_8UC1:cv.CV_8UC4);e.scanSize=new cv.Size(e.ScanWindowWidth,e.ScanWindowHeight),e.outputSize=new cv.Size(e.MiniWindowWidth,e.MiniWindowHeight);var a=.5*t,s=.5*i,o=.5*e.scanSize.width,n=.8*e.scanSize.height;e.rect=new cv.Rect(a-o,s-n,e.scanSize.width,e.scanSize.height),e.dst2=new cv.Mat(e.scanSize.height,e.scanSize.width,e.GrayMode?cv.CV_8UC1:cv.CV_8UC4),e.dst3=new cv.Mat(e.scanSize.height,e.scanSize.width,e.GrayMode?cv.CV_8UC1:cv.CV_8UC4),e.ScreenResolutionText.element.text="Video feed : "+t+" x "+i,e.openCVReady=!0}},t.src="https://docs.opencv.org/4.5.2/opencv.js",document.getElementsByTagName("head")[0].appendChild(t)},GameMgr.prototype.onResize=function(){var e=this.app.graphicsDevice,t=e.width,i=e.height,a=this.video.videoWidth,s=this.video.videoHeight;if(this.ScreenResolutionText.element.text="Video feed : "+this.video.videoWidth+" x "+this.video.videoHeight,this.entity.model&&this.entity.model.model){var o=this.entity.model.model.meshInstances[0].material;o.setParameter("uVideoSize",new Float32Array([a,s])),o.setParameter("uCanvasSize",new Float32Array([t,i]))}},GameMgr.prototype.addVideoToDom=function(){var e=this.video.style;e.position="absolute",e.width="1%",e.height="1%",document.body.appendChild(this.video)},GameMgr.prototype.useVideoTexture=function(){var e=this.app.graphicsDevice;this.texture=new pc.Texture(e,{format:pc.PIXELFORMAT_R8_G8_B8}),this.texture.magFilter=pc.FILTER_LINEAR,this.texture.minFilter=pc.FILTER_LINEAR,this.texture.setSource(this.video);var t=new pc.Shader(e,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","uniform vec2 uCanvasSize;","uniform vec2 uVideoSize;","","varying vec2 vUv0;","","void main(void)","{","    vUv0 = aPosition;","    float vw = uVideoSize.x;","    float vh = uVideoSize.y;","    float va = uVideoSize.x / uVideoSize.y;","    float cw = uCanvasSize.x;","    float ch = uCanvasSize.y;","    float ca = uCanvasSize.x / uCanvasSize.y;","    if (ca < va)","    {","        vUv0.x *= ca / va;","    }","    else","    {","        vUv0.y *= va / ca;","    }","    vUv0 *= 0.5;","    vUv0 += 0.5;","    gl_Position = vec4(aPosition, 1.0, 1.0);","}"].join("\n"),fshader:["precision "+e.precision+" float;","","varying vec2 vUv0;","","uniform sampler2D uVideoMap;","","void main(void)","{","    gl_FragColor = texture2D(uVideoMap, vUv0);","}"].join("\n")}),i=new pc.VertexFormat(e,[{semantic:pc.SEMANTIC_POSITION,components:2,type:pc.ELEMENTTYPE_FLOAT32}]),a=new pc.VertexBuffer(e,i,4),s=a.lock();new Float32Array(s).set([-1,-1,1,-1,-1,1,1,1]),a.unlock();var o=new pc.Mesh;o.vertexBuffer=a,o.primitive[0]={type:pc.PRIMITIVE_TRISTRIP,base:0,count:4,indexed:!1};var n=new pc.Material;n.shader=t,n.depthTest=!1,n.depthWrite=!1,n.setParameter("uVideoMap",this.texture);var r=e.width,d=e.height,h=this.video.videoWidth,c=this.video.videoHeight;n.setParameter("uVideoSize",new Float32Array([h,c])),n.setParameter("uCanvasSize",new Float32Array([r,d]));var u=new pc.GraphNode,p=new pc.MeshInstance(u,o,n),v=new pc.Model;v.graph=u,v.meshInstances=[p],this.entity.addComponent("model",{type:"asset",castShadows:!1}),this.entity.model.model=v},GameMgr.prototype.startVideo=function(){this.useVideoTexture(),pc.platform.ios&&this.addVideoToDom()},GameMgr.prototype.supportsVideoMode=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia},GameMgr.prototype.enterVideoMode=function(e,t){var i=this;navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"users",width:{min:640,ideal:1080},height:{min:480,ideal:720}}}).then((function(t){i.videoPlaying=!1;var a=document.createElement("video");a.setAttribute("autoplay",""),a.setAttribute("muted",""),a.setAttribute("playsinline",""),a.srcObject=t,i.video=a,i.app.graphicsDevice.on("resizecanvas",(function(){i.onResize()})),a.addEventListener("resize",(function(){i.onResize()})),a.addEventListener("canplay",(function(){i.videoPlaying||(i.startVideo(),i.startOpenCV(),i.videoPlaying=!0,e&&e())})),pc.platform.mobile&&window.addEventListener("touchstart",(function(t){t.preventDefault(),i.videoPlaying||(i.startVideo(),i.startOpenCV(),i.videoPlaying=!0,e&&e())})),navigator.mediaDevices.enumerateDevices().then((function(e){i.app.fire("webcamera:ready"),e.forEach((function(e){console.log(e.kind+": "+e.label+" id = "+e.deviceId)}))})).catch((function(e){i.app.fire("webcamera:ready"),console.log("ERROR: Unable to acquire camera stream "+e)}))})).catch((function(e){i.app.fire("webcamera:ready"),console.log(e.name+": "+e.message)}))},GameMgr.prototype.exitVideoMode=function(){this.video&&(this.video.stop(),this.src.delete(),this.dst.delete(),this.video.parentElement&&document.body.removeChild(this.video))};var Ui=pc.createScript("ui");Ui.attributes.add("css",{type:"asset",assetType:"css",title:"CSS Asset"}),Ui.attributes.add("html",{type:"asset",assetType:"html",title:"HTML Asset"}),Ui.prototype.initialize=function(){var t=document.createElement("style");document.head.appendChild(t),t.innerHTML=this.css.resource||"",this.div=document.createElement("div"),this.div.classList.add("container"),this.div.innerHTML=this.html.resource||"",document.body.appendChild(this.div),this.counter=0,this.bindEvents()},Ui.prototype.bindEvents=function(){var t=this,e=this.div.querySelector(".button"),i=this.div.querySelector(".counter");e&&e.addEventListener("click",(function(){++t.counter,i&&(i.textContent=t.counter),console.log("button clicked");var e=pc.app.root.findByName("chamferbox");if(e&&e.model&&e.model.model){var s=e.model.model.meshInstances[0].material;s&&(s.diffuse.set(Math.random(),Math.random(),Math.random()),s.update())}}),!1),i&&(i.textContent=t.counter)};var RenderLayerTotexture=pc.createScript("renderLayerTotexture");RenderLayerTotexture.attributes.add("layerName",{type:"string"}),RenderLayerTotexture.prototype.initialize=function(){var e=new pc.Texture(this.app.graphicsDevice,{width:400,height:200,format:pc.PIXELFORMAT_R8_G8_B8,autoMipmap:!0});e.minFilter=pc.FILTER_LINEAR,e.magFilter=pc.FILTER_LINEAR;var r=new pc.RenderTarget(this.app.graphicsDevice,e,{depth:!0});r.name="RTTRenderTarget",this.app.scene.layers.getLayerByName(this.layerName).renderTarget=r};var ApplyTexture=pc.createScript("applyTexture");ApplyTexture.attributes.add("layerName",{type:"string"}),ApplyTexture.prototype.postInitialize=function(){var e=this.app.scene.layers.getLayerByName(this.layerName),t=this.entity.element.material;t.diffuseMap=e.renderTarget.colorBuffer,t.update()};var HeartBeatRenderer=pc.createScript("heartBeatRenderer");HeartBeatRenderer.attributes.add("layerName",{type:"string"}),HeartBeatRenderer.attributes.add("heart",{type:"entity"}),HeartBeatRenderer.prototype.initialize=function(){this.RTTlayer=this.app.scene.layers.getLayerById(this.layerName),this.fig=new matplot.Figure("plot",300,200),this.ax=this.fig.axes(),this.pos=[],this.time=[]},HeartBeatRenderer.prototype.setArrays=function(e,t,r,a,i){this.ax.plot(t,e,{color:"blue",linewidth:2}),this.fig.draw(r-.5*i,a+.5*i)};var MeshLines=pc.createScript("meshLines");MeshLines.prototype.postInitialize=function(){var s,e=this.app,i=new pc.Mesh(e.graphicsDevice);i.clear(!0,!1);var t=new pc.GraphNode,n=new pc.StandardMaterial;n.emissive=pc.Color.WHITE,n.emissiveIntensity=1;for(this.positions=new Float32Array(120),s=0;s<20;s++){var o=2*s*3,a=3*(2*s+1),r=this.entity.getPosition();this.positions[o+0]=r.x-1,this.positions[o+1]=r.y+.1*s,this.positions[o+2]=r.z,this.positions[a+0]=r.x+1,this.positions[a+1]=r.y+.1*s,this.positions[a+2]=r.z}for(this.indexArray=[],s=0;s<20;s++)this.indexArray.push(2*s),this.indexArray.push(2*s+1);i.setPositions(this.positions),i.setNormals(pc.calculateNormals(this.positions,this.indexArray)),i.setIndices(this.indexArray),i.update(pc.PRIMITIVE_LINES);var p=new pc.MeshInstance(t,i,n),h=new pc.Model;h.graph=t,h.meshInstances=[p],e.systems.model.addComponent(this.entity,{type:"asset"});var c=this.app.scene.layers.getLayerByName("RenderToTexture");this.entity.model.layers=[c.id],this.entity.model.model=h,this.entity.model.model.meshInstances[0].material=n},MeshLines.prototype.update=function(s){};var ChangeText=pc.createScript("changeText");ChangeText.prototype.initialize=function(){this.entity.element.text=this.entity.element.text.replace("\\n","\n")};var numeric="undefined"==typeof exports?function numeric(){}:exports;"undefined"!=typeof global&&(global.numeric=numeric),numeric.version="1.2.3",numeric.bench=function bench(r,n){var e,i,o;for(void 0===n&&(n=15),i=1,e=new Date;;){for(o=i*=2;o>3;o-=4)r(),r(),r(),r();for(;o>0;)r(),o--;if(new Date-e>n)break}for(o=i;o>3;o-=4)r(),r(),r(),r();for(;o>0;)r(),o--;return 1e3*(3*i-1)/(new Date-e)},numeric.Function=Function,numeric.precision=4,numeric.largeArray=50,numeric.prettyPrint=function prettyPrint(r){function fmtnum(r){if(0===r)return"0";if(isNaN(r))return"NaN";if(r<0)return"-"+fmtnum(-r);if(isFinite(r)){var n=Math.floor(Math.log(r)/Math.log(10)),e=r/Math.pow(10,n),i=e.toPrecision(numeric.precision);return 10===parseFloat(i)&&(n++,i=(e=1).toPrecision(numeric.precision)),parseFloat(i).toString()+"e"+n.toString()}return"Infinity"}var n=[];return function foo(r){var e;if(void 0===r)return n.push(Array(numeric.precision+8).join(" ")),!1;if("string"==typeof r)return n.push('"'+r+'"'),!1;if("boolean"==typeof r)return n.push(r.toString()),!1;if("number"==typeof r){var i=fmtnum(r),o=r.toPrecision(numeric.precision),u=parseFloat(r.toString()).toString(),c=[i,o,u,parseFloat(o).toString(),parseFloat(u).toString()];for(e=1;e<c.length;e++)c[e].length<i.length&&(i=c[e]);return n.push(Array(numeric.precision+8-i.length).join(" ")+i),!1}if(null===r)return n.push("null"),!1;if("function"==typeof r){n.push(r.toString());var a=!1;for(e in r)r.hasOwnProperty(e)&&(a?n.push(",\n"):n.push("\n{"),a=!0,n.push(e),n.push(": \n"),foo(r[e]));return a&&n.push("}\n"),!0}if(r instanceof Array){if(r.length>numeric.largeArray)return n.push("...Large Array..."),!0;a=!1;for(n.push("["),e=0;e<r.length;e++)e>0&&(n.push(","),a&&n.push("\n ")),a=foo(r[e]);return n.push("]"),!0}for(e in n.push("{"),a=!1,r)r.hasOwnProperty(e)&&(a&&n.push(",\n"),a=!0,n.push(e),n.push(": \n"),foo(r[e]));return n.push("}"),!0}(r),n.join("")},numeric.parseDate=function parseDate(r){return function foo(r){if("string"==typeof r)return Date.parse(r.replace(/-/g,"/"));if(!(r instanceof Array))throw new Error("parseDate: parameter must be arrays of strings");var n,e=[];for(n=0;n<r.length;n++)e[n]=foo(r[n]);return e}(r)},numeric.parseFloat=function parseFloat_(r){return function foo(r){if("string"==typeof r)return parseFloat(r);if(!(r instanceof Array))throw new Error("parseFloat: parameter must be arrays of strings");var n,e=[];for(n=0;n<r.length;n++)e[n]=foo(r[n]);return e}(r)},numeric.parseCSV=function parseCSV(r){var n,e,i,o=r.split("\n"),u=[],c=/(([^'",]*)|('[^']*')|("[^"]*")),/g,a=/^\s*(([+-]?[0-9]+(\.[0-9]*)?(e[+-]?[0-9]+)?)|([+-]?[0-9]*(\.[0-9]+)?(e[+-]?[0-9]+)?))\s*$/,f=0;for(e=0;e<o.length;e++){var m,s=(o[e]+",").match(c);if(s.length>0){for(u[f]=[],n=0;n<s.length;n++)m=(i=s[n]).substr(0,i.length-1),a.test(m)?u[f][n]=parseFloat(m):u[f][n]=m;f++}}return u},numeric.toCSV=function toCSV(r){var n,e,i,o,u,c=numeric.dim(r);for(i=c[0],c[1],u=[],n=0;n<i;n++){for(o=[],e=0;e<i;e++)o[e]=r[n][e].toString();u[n]=o.join(", ")}return u.join("\n")+"\n"},numeric.getURL=function getURL(r){var n=new XMLHttpRequest;return n.open("GET",r,!1),n.send(),n},numeric.imageURL=function imageURL(r){function crc32Array(r,n,e){void 0===n&&(n=0),void 0===e&&(e=r.length);var i,o=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],u=-1;r.length;for(i=n;i<e;i++)u=u>>>8^o[255&(u^r[i])];return-1^u}var n,e,i,o,u,c,a,f,m,s,h=r[0].length,p=r[0][0].length,l=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,p>>24&255,p>>16&255,p>>8&255,255&p,h>>24&255,h>>16&255,h>>8&255,255&h,8,2,0,0,0,-1,-2,-3,-4,-5,-6,-7,-8,73,68,65,84,8,29];for(s=crc32Array(l,12,29),l[29]=s>>24&255,l[30]=s>>16&255,l[31]=s>>8&255,l[32]=255&s,n=1,e=0,a=0;a<h;a++){for(a<h-1?l.push(0):l.push(1),u=3*p+1+(0===a)&255,c=3*p+1+(0===a)>>8&255,l.push(u),l.push(c),l.push(255&~u),l.push(255&~c),0===a&&l.push(0),f=0;f<p;f++)for(i=0;i<3;i++)e=(e+(n=(n+(u=(u=r[i][a][f])>255?255:u<0?0:Math.round(u)))%65521))%65521,l.push(u);l.push(0)}return m=(e<<16)+n,l.push(m>>24&255),l.push(m>>16&255),l.push(m>>8&255),l.push(255&m),o=l.length-41,l[33]=o>>24&255,l[34]=o>>16&255,l[35]=o>>8&255,l[36]=255&o,s=crc32Array(l,37),l.push(s>>24&255),l.push(s>>16&255),l.push(s>>8&255),l.push(255&s),l.push(0),l.push(0),l.push(0),l.push(0),l.push(73),l.push(69),l.push(78),l.push(68),l.push(174),l.push(66),l.push(96),l.push(130),"data:image/png;base64,"+function base64(r){var n,e,i,o,u,c,a,f=r.length,m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s="";for(n=0;n<f;n+=3)u=((3&(e=r[n]))<<4)+((i=r[n+1])>>4),c=((15&i)<<2)+((o=r[n+2])>>6),a=63&o,n+1>=f?c=a=64:n+2>=f&&(a=64),s+=m.charAt(e>>2)+m.charAt(u)+m.charAt(c)+m.charAt(a);return s}(l)},numeric._dim=function _dim(r){for(var n=[];"object"==typeof r;)n.push(r.length),r=r[0];return n},numeric.dim=function dim(r){var n;return"object"==typeof r?"object"==typeof(n=r[0])?"object"==typeof n[0]?numeric._dim(r):[r.length,n.length]:[r.length]:[]},numeric.mapreduce=function mapreduce(r,n){return numeric.Function("x","accum","_s","_k",'if(typeof accum === "undefined") accum = '+n+';\nif(typeof x === "number") { var xi = x; '+r+'; return accum; }\nif(typeof _s === "undefined") _s = numeric.dim(x);\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i,xi;\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) {\n        accum = arguments.callee(x[i],accum,_s,_k+1);\n    }    return accum;\n}\nfor(i=_n-1;i>=1;i-=2) { \n    xi = x[i];\n    '+r+";\n    xi = x[i-1];\n    "+r+";\n}\nif(i === 0) {\n    xi = x[i];\n    "+r+"\n}\nreturn accum;")},numeric.same=function same(r,n){var e,i;if(!(r instanceof Array&&n instanceof Array))return!1;if((i=r.length)!==n.length)return!1;for(e=0;e<i;e++)if(r[e]!==n[e]){if("object"!=typeof r[e])return!1;if(!same(r[e],n[e]))return!1}return!0},numeric.rep=function rep(r,n,e){void 0===e&&(e=0);var i,o=r[e],u=Array(o);if(e===r.length-1){for(i=o-2;i>=0;i-=2)u[i+1]=n,u[i]=n;return-1===i&&(u[0]=n),u}for(i=o-1;i>=0;i--)u[i]=numeric.rep(r,n,e+1);return u},numeric.dotMMsmall=function dotMMsmall(r,n){var e,i,o,u,c,a,f,m,s,h,p;for(u=r.length,c=n.length,a=n[0].length,f=Array(u),e=u-1;e>=0;e--){for(m=Array(a),s=r[e],o=a-1;o>=0;o--){for(h=s[c-1]*n[c-1][o],i=c-2;i>=1;i-=2)p=i-1,h+=s[i]*n[i][o]+s[p]*n[p][o];0===i&&(h+=s[0]*n[0][o]),m[o]=h}f[e]=m}return f},numeric._getCol=function _getCol(r,n,e){var i;for(i=r.length-1;i>0;--i)e[i]=r[i][n],e[--i]=r[i][n];0===i&&(e[0]=r[0][n])},numeric.dotMMbig=function dotMMbig(r,n){var e,i,o,u,c,a=numeric._getCol,f=n.length,m=Array(f),s=r.length,h=n[0].length,p=new Array(s);for(--f,i=--s;-1!==i;--i)p[i]=Array(h);for(i=--h;-1!==i;--i)for(a(n,i,m),o=s;-1!==o;--o){for(c=0,e=r[o],u=f;u>0;--u)c+=e[u]*m[u],c+=e[--u]*m[u];0===u&&(c+=e[0]*m[0]),p[o][i]=c}return p},numeric.dotMV=function dotMV(r,n){var e,i=r.length,o=(n.length,Array(i)),u=numeric.dotVV;for(e=i-1;e>=0;e--)o[e]=u(r[e],n);return o},numeric.dotVM=function dotVM(r,n){var e,i,o,u,c,a,f;for(o=r.length,u=n[0].length,c=Array(u),i=u-1;i>=0;i--){for(a=r[o-1]*n[o-1][i],e=o-2;e>=1;e-=2)f=e-1,a+=r[e]*n[e][i]+r[f]*n[f][i];0===e&&(a+=r[0]*n[0][i]),c[i]=a}return c},numeric.dotVV=function dotVV(r,n){var e,i,o=r.length,u=r[o-1]*n[o-1];for(e=o-2;e>=1;e-=2)i=e-1,u+=r[e]*n[e]+r[i]*n[i];return 0===e&&(u+=r[0]*n[0]),u},numeric.dot=function dot(r,n){var e=numeric.dim;switch(1e3*e(r).length+e(n).length){case 2002:return n.length<10?numeric.dotMMsmall(r,n):numeric.dotMMbig(r,n);case 2001:return numeric.dotMV(r,n);case 1002:return numeric.dotVM(r,n);case 1001:return numeric.dotVV(r,n);case 1e3:return numeric.mulVS(r,n);case 1:return numeric.mulSV(r,n);case 0:return r*n;default:throw new Error("numeric.dot only works on vectors and matrices")}},numeric.diag=function diag(r){var n,e,i,o,u=r.length,c=Array(u);for(n=u-1;n>=0;n--){for(o=Array(u),e=n+2,i=u-1;i>=e;i-=2)o[i]=0,o[i-1]=0;for(i>n&&(o[i]=0),o[n]=r[n],i=n-1;i>=1;i-=2)o[i]=0,o[i-1]=0;0===i&&(o[0]=0),c[n]=o}return c},numeric.getDiag=function(r){var n,e=Math.min(r.length,r[0].length),i=Array(e);for(n=e-1;n>=1;--n)i[n]=r[n][n],i[--n]=r[n][n];return 0===n&&(i[0]=r[0][0]),i},numeric.identity=function identity(r){return numeric.diag(numeric.rep([r],1))},numeric.pointwise=function pointwise(r,n,e){void 0===e&&(e="");var i,o,u=[],c=/\[i\]$/,a="";for(i=0;i<r.length;i++)c.test(r[i])?a=o=r[i].substring(0,r[i].length-3):o=r[i],u.push(o);return u[r.length]="_s",u[r.length+1]="_k",u[r.length+2]='if(typeof _s === "undefined") _s = numeric.dim('+a+');\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i, ret = Array(_n);\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) ret[i] = arguments.callee('+r.join(",")+",_s,_k+1);\n    return ret;\n}\n"+e+"\nfor(i=_n-1;i>=3;--i) { \n    "+n+"\n    --i;\n    "+n+"\n    --i;\n    "+n+"\n    --i;\n    "+n+"\n}\nwhile(i>=0) {\n    "+n+"\n    --i;\n}\nreturn ret;",numeric.Function.apply(null,u)},numeric._biforeach=function _biforeach(r,n,e,i,o){var u;if(i!==e.length-1)for(u=e[i]-1;u>=0;u--)_biforeach(r[u],n[u],e,i+1,o);else o(r,n)},numeric.anyV=numeric.mapreduce("if(xi) return true;","false"),numeric.allV=numeric.mapreduce("if(!xi) return false;","true"),numeric.any=function(r){return void 0===r.length?r:numeric.anyV(r)},numeric.all=function(r){return void 0===r.length?r:numeric.allV(r)},numeric.ops2={add:"+",sub:"-",mul:"*",div:"/",mod:"%",and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">=",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"},numeric.opseq={addeq:"+=",subeq:"-=",muleq:"*=",diveq:"/=",modeq:"%=",lshifteq:"<<=",rshifteq:">>=",rrshifteq:">>>=",andeq:"&=",oreq:"|=",xoreq:"^="},numeric.mathfuns=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"],numeric.ops1={neg:"-",not:"!",bnot:"~"},function(){var r,n;for(r in numeric.ops2)numeric.ops2.hasOwnProperty(r)&&(n=numeric.ops2[r],numeric[r+"VV"]=numeric.pointwise(["x[i]","y[i]"],"ret[i] = x[i] "+n+" y[i];"),numeric[r+"SV"]=numeric.pointwise(["x","y[i]"],"ret[i] = x "+n+" y[i];"),numeric[r+"VS"]=numeric.pointwise(["x[i]","y"],"ret[i] = x[i] "+n+" y;"),numeric[r]=numeric.Function("var n = arguments.length, i, x = arguments[0], y;\nvar VV = numeric."+r+"VV, VS = numeric."+r+"VS, SV = numeric."+r+'SV;\nfor(i=1;i!==n;++i) { \n  y = arguments[i];  if(typeof x === "object") {\n      if(typeof y === "object") x = VV(x,y);\n      else x = VS(x,y);\n  } else if(typeof y === "object") x = SV(x,y);\n  else x = x '+n+" y;\n}\nreturn x;\n"),numeric[n]=numeric[r]);for(r in numeric.ops1)numeric.ops1.hasOwnProperty(r)&&(n=numeric.ops1[r],numeric[r+"V"]=numeric.pointwise(["x[i]"],"ret[i] = "+n+"x[i];"),numeric[r]=numeric.Function("x",'if(typeof x === "object") return numeric.'+r+"V(x);\nreturn "+n+"(x);"));for(r=0;r<numeric.mathfuns.length;r++)n=numeric.mathfuns[r],numeric[n+"V"]=numeric.pointwise(["x[i]"],"ret[i] = fun(x[i]);","var fun = Math."+n+";"),numeric[n]=numeric.Function("x",'if(typeof x === "object") return numeric.'+n+"V(x);\nreturn Math."+n+"(x);");for(r in numeric.isNaNV=numeric.pointwise(["x[i]"],"ret[i] = isNaN(x[i]);"),numeric.isNaN=function isNaN(r){return"object"==typeof r?numeric.isNaNV(r):isNaN(r)},numeric.isFiniteV=numeric.pointwise(["x[i]"],"ret[i] = isFinite(x[i]);"),numeric.isFinite=function isNaN(r){return"object"==typeof r?numeric.isFiniteV(r):isFinite(r)},numeric.opseq)numeric.opseq.hasOwnProperty(r)&&(numeric[r+"S"]=numeric.Function("x","y","var n = x.length, i;\nfor(i=n-1;i>=0;i--) x[i] "+numeric.opseq[r]+" y;"),numeric[r+"V"]=numeric.Function("x","y","var n = x.length, i;\nfor(i=n-1;i>=0;i--) x[i] "+numeric.opseq[r]+" y[i];"),numeric[r]=numeric.Function("x","y",'var s = numeric.dim(x);\nif(typeof y === "number") { numeric._biforeach(x,y,s,0,numeric.'+r+"S); return x; }\nnumeric._biforeach(x,y,s,0,numeric."+r+"V);\nreturn x;"),numeric[numeric.opseq[r]]=numeric[r])}(),numeric._f2=["atan2","pow","max","min"],function(){var r,n;for(n=0;n<numeric._f2.length;++n)r=numeric._f2[n],numeric[r+"VV"]=numeric.pointwise(["x[i]","y[i]"],"ret[i] = zz(x[i],y[i]);","var zz = Math."+r+";"),numeric[r+"VS"]=numeric.pointwise(["x[i]","y"],"ret[i] = zz(x[i],y);","var zz = Math."+r+";"),numeric[r+"SV"]=numeric.pointwise(["x","y[i]"],"ret[i] = zz(x,y[i]);","var zz = Math."+r+";"),numeric[r]=Function("x","y",'if(typeof x === "object") {\n    if(typeof y === "object") return numeric.'+r+"VV(x,y);\n    return numeric."+r+'VS(x,y);\n}\nif (typeof y === "object") return numeric.'+r+"SV(x,y);\nreturn Math."+r+"(x,y);\n")}(),numeric.atan2VV=numeric.pointwise(["x[i]","y[i]"],"ret[i] = atan2(x[i],y[i]);","var atan2 = Math.atan2;"),numeric.atan2VS=numeric.pointwise(["x[i]","y"],"ret[i] = atan2(x[i],y);","var atan2 = Math.atan2;"),numeric.atan2SV=numeric.pointwise(["x","y[i]"],"ret[i] = atan2(x,y[i]);","var atan2 = Math.atan2;"),numeric.atan2=function atan2(r,n){return"object"==typeof r?"object"==typeof n?numeric.atan2VV(r,n):numeric.atan2VS(r,n):"object"==typeof n?numeric.atan2SV(r,n):Math.atan2(r,n)},numeric.truncVV=numeric.pointwise(["x[i]","y[i]"],"ret[i] = round(x[i]/y[i])*y[i];","var round = Math.round;"),numeric.truncVS=numeric.pointwise(["x[i]","y"],"ret[i] = round(x[i]/y)*y;","var round = Math.round;"),numeric.truncSV=numeric.pointwise(["x","y[i]"],"ret[i] = round(x/y[i])*y[i];","var round = Math.round;"),numeric.trunc=function trunc(r,n){return"object"==typeof r?"object"==typeof n?numeric.truncVV(r,n):numeric.truncVS(r,n):"object"==typeof n?numeric.truncSV(r,n):Math.round(r/n)*n},numeric.powVV=numeric.pointwise(["x[i]","y[i]"],"ret[i] = pow(x[i],y[i]);","var pow = Math.pow;"),numeric.powVS=numeric.pointwise(["x[i]","y"],"ret[i] = pow(x[i],y);","var pow = Math.pow;"),numeric.powSV=numeric.pointwise(["x","y[i]"],"ret[i] = pow(x,y[i]);","var pow = Math.pow;"),numeric.pow=function pow(r,n){return"object"==typeof r?"object"==typeof n?numeric.powVV(r,n):numeric.powVS(r,n):"object"==typeof n?numeric.powSV(r,n):Math.pow(r,n)},numeric.clone=numeric.pointwise(["x[i]"],"ret[i] = x[i];"),numeric.inv=function inv(r){var n,e,i,o,u,c,a,f=numeric.dim(r),m=Math.abs,s=f[0],h=f[1],p=numeric.clone(r),l=numeric.identity(s);for(c=0;c<h;++c){for(i0=-1,v0=-1,u=c;u!==s;++u)(a=m(p[u][c]))>v0&&(i0=u,v0=a);for(e=p[i0],p[i0]=p[c],p[c]=e,o=l[i0],l[i0]=l[c],l[c]=o,r=e[c],a=c;a!==h;++a)e[a]/=r;for(a=h-1;-1!==a;--a)o[a]/=r;for(u=s-1;-1!==u;--u)if(u!==c){for(n=p[u],i=l[u],r=n[c],a=c+1;a!==h;++a)n[a]-=e[a]*r;for(a=h-1;a>0;--a)i[a]-=o[a]*r,i[--a]-=o[a]*r;0===a&&(i[0]-=o[0]*r)}}return l},numeric.det=function det(r){var n=numeric.dim(r);if(2!==n.length||n[0]!==n[1])throw new Error("numeric: det() only works on square matrices");var e,i,o,u,c,a,f,m,s=n[0],h=1,p=numeric.clone(r);for(i=0;i<s-1;i++){for(o=i,e=i+1;e<s;e++)Math.abs(p[e][i])>Math.abs(p[o][i])&&(o=e);for(o!==i&&(f=p[o],p[o]=p[i],p[i]=f,h*=-1),u=p[i],e=i+1;e<s;e++){for(a=(c=p[e])[i]/u[i],o=i+1;o<s-1;o+=2)m=o+1,c[o]-=u[o]*a,c[m]-=u[m]*a;o!==s&&(c[o]-=u[o]*a)}if(0===u[i])return 0;h*=u[i]}return h*p[i][i]},numeric.transpose=function transpose(r){var n,e,i,o,u,c=r.length,a=r[0].length,f=Array(a);for(e=0;e<a;e++)f[e]=Array(c);for(n=c-1;n>=1;n-=2){for(o=r[n],i=r[n-1],e=a-1;e>=1;--e)(u=f[e])[n]=o[e],u[n-1]=i[e],(u=f[--e])[n]=o[e],u[n-1]=i[e];0===e&&((u=f[0])[n]=o[0],u[n-1]=i[0])}if(0===n){for(i=r[0],e=a-1;e>=1;--e)f[e][0]=i[e],f[--e][0]=i[e];0===e&&(f[0][0]=i[0])}return f},numeric.negtranspose=function negtranspose(r){var n,e,i,o,u,c=r.length,a=r[0].length,f=Array(a);for(e=0;e<a;e++)f[e]=Array(c);for(n=c-1;n>=1;n-=2){for(o=r[n],i=r[n-1],e=a-1;e>=1;--e)(u=f[e])[n]=-o[e],u[n-1]=-i[e],(u=f[--e])[n]=-o[e],u[n-1]=-i[e];0===e&&((u=f[0])[n]=-o[0],u[n-1]=-i[0])}if(0===n){for(i=r[0],e=a-1;e>=1;--e)f[e][0]=-i[e],f[--e][0]=-i[e];0===e&&(f[0][0]=-i[0])}return f},numeric._random=function _random(r,n){var e,i,o=r[n],u=Array(o);if(n===r.length-1){for(i=Math.random,e=o-1;e>=1;e-=2)u[e]=i(),u[e-1]=i();return 0===e&&(u[0]=i()),u}for(e=o-1;e>=0;e--)u[e]=_random(r,n+1);return u},numeric.random=function random(r){return numeric._random(r,0)},numeric.norm2Squared=function norm2Squared(r){},numeric.norm2Squared=numeric.mapreduce("accum += xi*xi;","0"),numeric.norm2=function norm2(r){return Math.sqrt(numeric.norm2Squared(r))},numeric.norminf=numeric.mapreduce("accum = max(abs(xi),accum);","0; var max = Math.max, abs = Math.abs;"),numeric.sum=numeric.mapreduce("accum += xi;","0"),numeric.sup=numeric.mapreduce("accum = max(xi,accum);","-Infinity; var max = Math.max;"),numeric.inf=numeric.mapreduce("accum = min(xi,accum);","Infinity; var min = Math.min;"),numeric.linspace=function linspace(r,n,e){if(void 0===e&&(e=Math.max(Math.round(n-r)+1,1)),e<2)return 1===e?[r]:[];var i,o=Array(e);for(i=--e;i>=0;i--)o[i]=(i*n+(e-i)*r)/e;return o},numeric.getBlock=function getBlock(r,n,e){var i=numeric.dim(r);return function foo(r,o){var u,c=n[o],a=e[o]-c,f=Array(a);if(o===i.length-1){for(u=a;u>=0;u--)f[u]=r[u+c];return f}for(u=a;u>=0;u--)f[u]=foo(r[u+c],o+1);return f}(r,0)},numeric.setBlock=function setBlock(r,n,e,i){var o=numeric.dim(r);return function foo(r,i,u){var c,a=n[u],f=e[u]-a;if(u===o.length-1)for(c=f;c>=0;c--)r[c+a]=i[c];for(c=f;c>=0;c--)foo(r[c+a],i[c],u+1)}(r,i,0),r},numeric.getRange=function getRange(r,n,e){var i,o,u,c,a=n.length,f=e.length,m=Array(a);for(i=a-1;-1!==i;--i)for(m[i]=Array(f),u=m[i],c=r[n[i]],o=f-1;-1!==o;--o)u[o]=c[e[o]];return m},numeric.blockMatrix=function blockMatrix(r){var n=numeric.dim(r);if(n.length<4)return numeric.blockMatrix([r]);var e,i,o,u,c,a=n[0],f=n[1];for(e=0,i=0,o=0;o<a;++o)e+=r[o][0].length;for(u=0;u<f;++u)i+=r[0][u][0].length;var m=Array(e);for(o=0;o<e;++o)m[o]=Array(i);var s,h,p,l,y,g=0;for(o=0;o<a;++o){for(s=i,u=f-1;-1!==u;--u)for(s-=(c=r[o][u])[0].length,p=c.length-1;-1!==p;--p)for(y=c[p],h=m[g+p],l=y.length-1;-1!==l;--l)h[s+l]=y[l];g+=r[o][0].length}return m},numeric.tensor=function tensor(r,n){if("number"==typeof r||"number"==typeof n)return numeric.mul(r,n);var e=numeric.dim(r),i=numeric.dim(n);if(1!==e.length||1!==i.length)throw new Error("numeric: tensor product is only defined for vectors");var o,u,c,a,f=e[0],m=i[0],s=Array(f);for(u=f-1;u>=0;u--){for(o=Array(m),a=r[u],c=m-1;c>=3;--c)o[c]=a*n[c],o[--c]=a*n[c],o[--c]=a*n[c],o[--c]=a*n[c];for(;c>=0;)o[c]=a*n[c],--c;s[u]=o}return s},numeric.T=function T(r,n){this.x=r,this.y=n},numeric.t=function t(r,n){return new numeric.T(r,n)},numeric.Tbinop=function Tbinop(r,n,e,i,o){var u;numeric.indexOf;if("string"!=typeof o)for(u in o="",numeric)numeric.hasOwnProperty(u)&&(r.indexOf(u)>=0||n.indexOf(u)>=0||e.indexOf(u)>=0||i.indexOf(u)>=0)&&u.length>1&&(o+="var "+u+" = numeric."+u+";\n");return numeric.Function(["y"],"var x = this;\nif(!(y instanceof numeric.T)) { y = new numeric.T(y); }\n"+o+"\nif(x.y) {  if(y.y) {    return new numeric.T("+i+");\n  }\n  return new numeric.T("+e+");\n}\nif(y.y) {\n  return new numeric.T("+n+");\n}\nreturn new numeric.T("+r+");\n")},numeric.T.prototype.add=numeric.Tbinop("add(x.x,y.x)","add(x.x,y.x),y.y","add(x.x,y.x),x.y","add(x.x,y.x),add(x.y,y.y)"),numeric.T.prototype.sub=numeric.Tbinop("sub(x.x,y.x)","sub(x.x,y.x),neg(y.y)","sub(x.x,y.x),x.y","sub(x.x,y.x),sub(x.y,y.y)"),numeric.T.prototype.mul=numeric.Tbinop("mul(x.x,y.x)","mul(x.x,y.x),mul(x.x,y.y)","mul(x.x,y.x),mul(x.y,y.x)","sub(mul(x.x,y.x),mul(x.y,y.y)),add(mul(x.x,y.y),mul(x.y,y.x))"),numeric.T.prototype.reciprocal=function reciprocal(){var r=numeric.mul,n=numeric.div;if(this.y){var e=numeric.add(r(this.x,this.x),r(this.y,this.y));return new numeric.T(n(this.x,e),n(numeric.neg(this.y),e))}return new T(n(1,this.x))},numeric.T.prototype.div=function div(r){if(r instanceof numeric.T||(r=new numeric.T(r)),r.y)return this.mul(r.reciprocal());var div=numeric.div;return this.y?new numeric.T(div(this.x,r.x),div(this.y,r.x)):new numeric.T(div(this.x,r.x))},numeric.T.prototype.dot=numeric.Tbinop("dot(x.x,y.x)","dot(x.x,y.x),dot(x.x,y.y)","dot(x.x,y.x),dot(x.y,y.x)","sub(dot(x.x,y.x),dot(x.y,y.y)),add(dot(x.x,y.y),dot(x.y,y.x))"),numeric.T.prototype.transpose=function transpose(){var r=numeric.transpose,n=this.x,e=this.y;return e?new numeric.T(r(n),r(e)):new numeric.T(r(n))},numeric.T.prototype.transjugate=function transjugate(){var r=numeric.transpose,n=this.x,e=this.y;return e?new numeric.T(r(n),numeric.negtranspose(e)):new numeric.T(r(n))},numeric.Tunop=function Tunop(r,n,e){return"string"!=typeof e&&(e=""),numeric.Function("var x = this;\n"+e+"\nif(x.y) {  "+n+";\n}\n"+r+";\n")},numeric.T.prototype.exp=numeric.Tunop("return new numeric.T(ex)","return new numeric.T(mul(cos(x.y),ex),mul(sin(x.y),ex))","var ex = numeric.exp(x.x), cos = numeric.cos, sin = numeric.sin, mul = numeric.mul;"),numeric.T.prototype.conj=numeric.Tunop("return new numeric.T(x.x);","return new numeric.T(x.x,numeric.neg(x.y));"),numeric.T.prototype.neg=numeric.Tunop("return new numeric.T(neg(x.x));","return new numeric.T(neg(x.x),neg(x.y));","var neg = numeric.neg;"),numeric.T.prototype.sin=numeric.Tunop("return new numeric.T(numeric.sin(x.x))","return x.exp().sub(x.neg().exp()).div(new numeric.T(0,2));"),numeric.T.prototype.cos=numeric.Tunop("return new numeric.T(numeric.cos(x.x))","return x.exp().add(x.neg().exp()).div(2);"),numeric.T.prototype.abs=numeric.Tunop("return new numeric.T(numeric.abs(x.x));","return new numeric.T(numeric.sqrt(numeric.add(mul(x.x,x.x),mul(x.y,x.y))));","var mul = numeric.mul;"),numeric.T.prototype.log=numeric.Tunop("return new numeric.T(numeric.log(x.x));","var theta = new numeric.T(numeric.atan2(x.y,x.x)), r = x.abs();\nreturn new numeric.T(numeric.log(r.x),theta.x);"),numeric.T.prototype.norm2=numeric.Tunop("return numeric.norm2(x.x);","var f = numeric.norm2Squared;\nreturn Math.sqrt(f(x.x)+f(x.y));"),numeric.T.prototype.inv=function inv(){var r=this;if(void 0===r.y)return new numeric.T(numeric.inv(r.x));var n,e,i,o,u,c,a,f,m,s,h,p,l,y,g,d,v,x,w=r.x.length,b=numeric.identity(w),M=numeric.rep([w,w],0),j=numeric.clone(r.x),S=numeric.clone(r.y);for(m=0;m<w;m++){for(p=(y=j[m][m])*y+(g=S[m][m])*g,h=m,s=m+1;s<w;s++)(l=(y=j[s][m])*y+(g=S[s][m])*g)>p&&(h=s,p=l);for(h!==m&&(x=j[m],j[m]=j[h],j[h]=x,x=S[m],S[m]=S[h],S[h]=x,x=b[m],b[m]=b[h],b[h]=x,x=M[m],M[m]=M[h],M[h]=x),n=j[m],e=S[m],u=b[m],c=M[m],y=n[m],g=e[m],s=m+1;s<w;s++)d=n[s],v=e[s],n[s]=(d*y+v*g)/p,e[s]=(v*y-d*g)/p;for(s=0;s<w;s++)d=u[s],v=c[s],u[s]=(d*y+v*g)/p,c[s]=(v*y-d*g)/p;for(s=m+1;s<w;s++){for(i=j[s],o=S[s],a=b[s],f=M[s],y=i[m],g=o[m],h=m+1;h<w;h++)d=n[h],v=e[h],i[h]-=d*y-v*g,o[h]-=v*y+d*g;for(h=0;h<w;h++)d=u[h],v=c[h],a[h]-=d*y-v*g,f[h]-=v*y+d*g}}for(m=w-1;m>0;m--)for(u=b[m],c=M[m],s=m-1;s>=0;s--)for(a=b[s],f=M[s],y=j[s][m],g=S[s][m],h=w-1;h>=0;h--)d=u[h],v=c[h],a[h]-=y*d-g*v,f[h]-=y*v+g*d;return new numeric.T(b,M)},numeric.T.prototype.get=function get(r){var n,e=this.x,i=this.y,o=0,u=r.length;if(i){for(;o<u;)e=e[n=r[o]],i=i[n],o++;return new numeric.T(e,i)}for(;o<u;)e=e[n=r[o]],o++;return new numeric.T(e)},numeric.T.prototype.set=function set(r,n){var e,i=this.x,o=this.y,u=0,c=r.length,a=n.x,f=n.y;if(0===c)return f?this.y=f:o&&(this.y=void 0),this.x=i,this;if(f){for(o||(o=numeric.rep(numeric.dim(i),0),this.y=o);u<c-1;)i=i[e=r[u]],o=o[e],u++;return i[e=r[u]]=a,o[e]=f,this}if(o){for(;u<c-1;)i=i[e=r[u]],o=o[e],u++;return i[e=r[u]]=a,o[e]=a instanceof Array?numeric.rep(numeric.dim(a),0):0,this}for(;u<c-1;)i=i[e=r[u]],u++;return i[e=r[u]]=a,this},numeric.T.prototype.getRows=function getRows(r,n){var e,i,o=n-r+1,u=Array(o),c=this.x,a=this.y;for(e=r;e<=n;e++)u[e-r]=c[e];if(a){for(i=Array(o),e=r;e<=n;e++)i[e-r]=a[e];return new numeric.T(u,i)}return new numeric.T(u)},numeric.T.prototype.setRows=function setRows(r,n,e){var i,o=this.x,u=this.y,c=e.x,a=e.y;for(i=r;i<=n;i++)o[i]=c[i-r];if(a)for(u||(u=numeric.rep(numeric.dim(o),0),this.y=u),i=r;i<=n;i++)u[i]=a[i-r];else if(u)for(i=r;i<=n;i++)u[i]=numeric.rep([c[i-r].length],0);return this},numeric.T.prototype.getRow=function getRow(r){var n=this.x,e=this.y;return e?new numeric.T(n[r],e[r]):new numeric.T(n[r])},numeric.T.prototype.setRow=function setRow(r,n){var e=this.x,i=this.y,o=n.x,u=n.y;return e[r]=o,u?(i||(i=numeric.rep(numeric.dim(e),0),this.y=i),i[r]=u):i&&(i=numeric.rep([o.length],0)),this},numeric.T.prototype.getBlock=function getBlock(r,n){var e=this.x,i=this.y,o=numeric.getBlock;return i?new numeric.T(o(e,r,n),o(i,r,n)):new numeric.T(o(e,r,n))},numeric.T.prototype.setBlock=function setBlock(r,n,e){e instanceof numeric.T||(e=new numeric.T(e));var i=this.x,o=this.y,u=numeric.setBlock,c=e.x,a=e.y;if(a)return o||(this.y=numeric.rep(numeric.dim(this),0),o=this.y),u(i,r,n,c),u(o,r,n,a),this;u(i,r,n,c),o&&u(o,r,n,numeric.rep(numeric.dim(c),0))},numeric.T.rep=function rep(r,n){var e=numeric.T;n instanceof e||(n=new e(n));var i=n.x,o=n.y,u=numeric.rep;return o?new e(u(r,i),u(r,o)):new e(u(r,i))},numeric.T.diag=function diag(r){r instanceof numeric.T||(r=new numeric.T(r));var n=r.x,e=r.y,diag=numeric.diag;return e?new numeric.T(diag(n),diag(e)):new numeric.T(diag(n))},numeric.T.eig=function eig(){if(this.y)throw new Error("eig: not implemented for complex matrices.");return numeric.eig(this.x)},numeric.T.identity=function identity(r){return new numeric.T(numeric.identity(r))},numeric.T.prototype.getDiag=function getDiag(){var r=numeric,n=this.x,e=this.y;return e?new r.T(r.getDiag(n),r.getDiag(e)):new r.T(r.getDiag(n))},numeric.house=function house(r){var n=numeric.clone(r),e=(r[0]>=0?1:-1)*numeric.norm2(r);n[0]+=e;var i=numeric.norm2(n);if(0===i)throw new Error("eig: internal error");return numeric.div(n,i)},numeric.toUpperHessenberg=function toUpperHessenberg(r){var n=numeric.dim(r);if(2!==n.length||n[0]!==n[1])throw new Error("numeric: toUpperHessenberg() only works on square matrices");var e,i,o,u,c,a,f,m,s,h,p=n[0],l=numeric.clone(r),y=numeric.identity(p);for(i=0;i<p-2;i++){for(u=Array(p-i-1),e=i+1;e<p;e++)u[e-i-1]=l[e][i];if(numeric.norm2(u)>0){for(c=numeric.house(u),a=numeric.getBlock(l,[i+1,i],[p-1,p-1]),f=numeric.tensor(c,numeric.dot(c,a)),e=i+1;e<p;e++)for(m=l[e],s=f[e-i-1],o=i;o<p;o++)m[o]-=2*s[o-i];for(a=numeric.getBlock(l,[0,i+1],[p-1,p-1]),f=numeric.tensor(numeric.dot(a,c),c),e=0;e<p;e++)for(m=l[e],s=f[e],o=i+1;o<p;o++)m[o]-=2*s[o-i-1];for(a=Array(p-i-1),e=i+1;e<p;e++)a[e-i-1]=y[e];for(f=numeric.tensor(c,numeric.dot(c,a)),e=i+1;e<p;e++)for(h=y[e],s=f[e-i-1],o=0;o<p;o++)h[o]-=2*s[o]}}return{H:l,Q:y}},numeric.epsilon=2220446049250313e-31,numeric.QRFrancis=function(r,n){void 0===n&&(n=1e4),r=numeric.clone(r);numeric.clone(r);var e,i,o,u,c,a,f,m,s,h,p,l,y,g,d,v,x,w,b=numeric.dim(r)[0],M=numeric.identity(b);if(b<3)return{Q:M,B:[[0,b-1]]};var j=numeric.epsilon;for(w=0;w<n;w++){for(v=0;v<b-1;v++)if(Math.abs(r[v+1][v])<j*(Math.abs(r[v][v])+Math.abs(r[v+1][v+1]))){var S=numeric.QRFrancis(numeric.getBlock(r,[0,0],[v,v]),n),V=numeric.QRFrancis(numeric.getBlock(r,[v+1,v+1],[b-1,b-1]),n);for(l=Array(v+1),d=0;d<=v;d++)l[d]=M[d];for(y=numeric.dot(S.Q,l),d=0;d<=v;d++)M[d]=y[d];for(l=Array(b-v-1),d=v+1;d<b;d++)l[d-v-1]=M[d];for(y=numeric.dot(V.Q,l),d=v+1;d<b;d++)M[d]=y[d-v-1];return{Q:M,B:S.B.concat(numeric.add(V.B,v+1))}}var _,q,P;if(o=r[b-2][b-2],u=r[b-2][b-1],c=r[b-1][b-2],m=o+(a=r[b-1][b-1]),f=o*a-u*c,s=numeric.getBlock(r,[0,0],[2,2]),m*m>=4*f)_=.5*(m+Math.sqrt(m*m-4*f)),q=.5*(m-Math.sqrt(m*m-4*f)),s=numeric.add(numeric.sub(numeric.dot(s,s),numeric.mul(s,_+q)),numeric.diag(numeric.rep([3],_*q)));else s=numeric.add(numeric.sub(numeric.dot(s,s),numeric.mul(s,m)),numeric.diag(numeric.rep([3],f)));for(e=[s[0][0],s[1][0],s[2][0]],i=numeric.house(e),l=[r[0],r[1],r[2]],y=numeric.tensor(i,numeric.dot(i,l)),d=0;d<3;d++)for(p=r[d],g=y[d],x=0;x<b;x++)p[x]-=2*g[x];for(l=numeric.getBlock(r,[0,0],[b-1,2]),y=numeric.tensor(numeric.dot(l,i),i),d=0;d<b;d++)for(p=r[d],g=y[d],x=0;x<3;x++)p[x]-=2*g[x];for(l=[M[0],M[1],M[2]],y=numeric.tensor(i,numeric.dot(i,l)),d=0;d<3;d++)for(h=M[d],g=y[d],x=0;x<b;x++)h[x]-=2*g[x];for(v=0;v<b-2;v++){for(x=v;x<=v+1;x++)if(Math.abs(r[x+1][x])<j*(Math.abs(r[x][x])+Math.abs(r[x+1][x+1]))){S=numeric.QRFrancis(numeric.getBlock(r,[0,0],[x,x]),n),V=numeric.QRFrancis(numeric.getBlock(r,[x+1,x+1],[b-1,b-1]),n);for(l=Array(x+1),d=0;d<=x;d++)l[d]=M[d];for(y=numeric.dot(S.Q,l),d=0;d<=x;d++)M[d]=y[d];for(l=Array(b-x-1),d=x+1;d<b;d++)l[d-x-1]=M[d];for(y=numeric.dot(V.Q,l),d=x+1;d<b;d++)M[d]=y[d-x-1];return{Q:M,B:S.B.concat(numeric.add(V.B,x+1))}}for(P=Math.min(b-1,v+3),e=Array(P-v),d=v+1;d<=P;d++)e[d-v-1]=r[d][v];for(i=numeric.house(e),l=numeric.getBlock(r,[v+1,v],[P,b-1]),y=numeric.tensor(i,numeric.dot(i,l)),d=v+1;d<=P;d++)for(p=r[d],g=y[d-v-1],x=v;x<b;x++)p[x]-=2*g[x-v];for(l=numeric.getBlock(r,[0,v+1],[b-1,P]),y=numeric.tensor(numeric.dot(l,i),i),d=0;d<b;d++)for(p=r[d],g=y[d],x=v+1;x<=P;x++)p[x]-=2*g[x-v-1];for(l=Array(P-v),d=v+1;d<=P;d++)l[d-v-1]=M[d];for(y=numeric.tensor(i,numeric.dot(i,l)),d=v+1;d<=P;d++)for(h=M[d],g=y[d-v-1],x=0;x<b;x++)h[x]-=2*g[x]}}throw new Error("numeric: eigenvalue iteration does not converge -- increase maxiter?")},numeric.eig=function eig(r,n){var e,i,o,u,c,a,f,m,s,h,p,l,y,g,d,v,x=numeric.toUpperHessenberg(r),w=numeric.QRFrancis(x.H,n),b=numeric.T,M=r.length,j=w.B,S=numeric.dot(w.Q,numeric.dot(x.H,numeric.transpose(w.Q))),V=new b(numeric.dot(w.Q,x.Q)),_=j.length,q=Math.sqrt;for(i=0;i<_;i++)if((e=j[i][0])===j[i][1]);else{if(u=e+1,c=S[e][e],a=S[e][u],f=S[u][e],m=S[u][u],0===a&&0===f)continue;(h=(s=-c-m)*s-4*(c*m-a*f))>=0?((d=(c-(p=s<0?-.5*(s-q(h)):-.5*(s+q(h))))*(c-p)+a*a)>(v=f*f+(m-p)*(m-p))?(y=(c-p)/(d=q(d)),g=a/d):(y=f/(v=q(v)),g=(m-p)/v),o=new b([[g,-y],[y,g]]),V.setRows(e,u,o.dot(V.getRows(e,u)))):(p=-.5*s,l=.5*q(-h),(d=(c-p)*(c-p)+a*a)>(v=f*f+(m-p)*(m-p))?(y=(c-p)/(d=q(d+l*l)),g=a/d,p=0,l/=d):(y=f/(v=q(v+l*l)),g=(m-p)/v,p=l/v,l=0),o=new b([[g,-y],[y,g]],[[p,l],[l,-p]]),V.setRows(e,u,o.dot(V.getRows(e,u))))}var P=V.dot(r).dot(V.transjugate()),L=(M=r.length,numeric.T.identity(M));for(u=0;u<M;u++)if(u>0)for(i=u-1;i>=0;i--){var N=P.get([i,i]),F=P.get([u,u]);numeric.neq(N.x,F.x)||numeric.neq(N.y,F.y)?(p=P.getRow(i).getBlock([i],[u-1]),l=L.getRow(u).getBlock([i],[u-1]),L.set([u,i],P.get([i,u]).neg().sub(p.dot(l)).div(N.sub(F)))):L.setRow(u,L.getRow(i))}for(u=0;u<M;u++)p=L.getRow(u),L.setRow(u,p.div(p.norm2()));return L=L.transpose(),L=V.transjugate().dot(L),{lambda:P.getDiag(),E:L}},numeric.ccsSparse=function ccsSparse(r){var n,e,i,o=r.length,u=[];for(e=o-1;-1!==e;--e)for(i in n=r[e]){for(i=parseInt(i);i>=u.length;)u[u.length]=0;0!==n[i]&&u[i]++}var c=u.length,a=Array(c+1);for(a[0]=0,e=0;e<c;++e)a[e+1]=a[e]+u[e];var f=Array(a[c]),m=Array(a[c]);for(e=o-1;-1!==e;--e)for(i in n=r[e])0!==n[i]&&(u[i]--,f[a[i]+u[i]]=e,m[a[i]+u[i]]=n[i]);return[a,f,m]},numeric.ccsFull=function ccsFull(r){var n,e,i,o,u=r[0],c=r[1],a=r[2],f=numeric.ccsDim(r),m=f[0],s=f[1],h=numeric.rep([m,s],0);for(n=0;n<s;n++)for(i=u[n],o=u[n+1],e=i;e<o;++e)h[c[e]][n]=a[e];return h},numeric.ccsTSolve=function ccsTSolve(r,n,e,i,o){var u,c,a,f,m,s,h,p=r[0],l=r[1],y=r[2],g=p.length-1,d=Math.max,v=0;function dfs(r){var n;if(0===e[r]){for(e[r]=1,n=p[r];n<p[r+1];++n)dfs(l[n]);o[v]=r,++v}}for(void 0===i&&(e=numeric.rep([g],0)),void 0===i&&(i=numeric.linspace(0,e.length-1)),void 0===o&&(o=[]),u=i.length-1;-1!==u;--u)dfs(i[u]);for(o.length=v,u=o.length-1;-1!==u;--u)e[o[u]]=0;for(u=i.length-1;-1!==u;--u)c=i[u],e[c]=n[c];for(u=o.length-1;-1!==u;--u){for(c=o[u],a=p[c],f=d(p[c+1],a),m=a;m!==f;++m)if(l[m]===c){e[c]/=y[m];break}for(h=e[c],m=a;m!==f;++m)(s=l[m])!==c&&(e[s]-=h*y[m])}return e},numeric.ccsDFS=function ccsDFS(r){this.k=Array(r),this.k1=Array(r),this.j=Array(r)},numeric.ccsDFS.prototype.dfs=function dfs(r,n,e,i,o,u){var c,a,f,m=0,s=o.length,h=this.k,p=this.k1,l=this.j;if(0===i[r])for(i[r]=1,l[0]=r,h[0]=a=n[r],p[0]=f=n[r+1];;)if(a>=f){if(o[s]=l[m],0===m)return;++s,a=h[--m],f=p[m]}else 0===i[c=u[e[a]]]?(i[c]=1,h[m]=a,l[++m]=c,a=n[c],p[m]=f=n[c+1]):++a},numeric.ccsLPSolve=function ccsLPSolve(r,n,e,i,o,u,c){var a,f,m,s,h,p,l,y,g,d=r[0],v=r[1],x=r[2],w=(d.length,n[0]),b=n[1],M=n[2];for(f=w[o],m=w[o+1],i.length=0,a=f;a<m;++a)c.dfs(u[b[a]],d,v,e,i,u);for(a=i.length-1;-1!==a;--a)e[i[a]]=0;for(a=f;a!==m;++a)e[s=u[b[a]]]=M[a];for(a=i.length-1;-1!==a;--a){for(h=d[s=i[a]],p=d[s+1],l=h;l<p;++l)if(u[v[l]]===s){e[s]/=x[l];break}for(g=e[s],l=h;l<p;++l)(y=u[v[l]])!==s&&(e[y]-=g*x[l])}return e},numeric.ccsLUP1=function ccsLUP1(r,n){var e,i,o,u,c,a,f,m=r[0].length-1,s=[numeric.rep([m+1],0),[],[]],h=[numeric.rep([m+1],0),[],[]],p=s[0],l=s[1],y=s[2],g=h[0],d=h[1],v=h[2],x=numeric.rep([m],0),w=numeric.rep([m],0),b=numeric.ccsLPSolve,M=(Math.max,Math.abs),j=numeric.linspace(0,m-1),S=numeric.linspace(0,m-1),V=new numeric.ccsDFS(m);for(void 0===n&&(n=1),e=0;e<m;++e){for(b(s,r,x,w,e,S,V),u=-1,c=-1,i=w.length-1;-1!==i;--i)(o=w[i])<=e||(a=M(x[o]))>u&&(c=o,u=a);for(M(x[e])<n*u&&(i=j[e],u=j[c],j[e]=u,S[u]=e,j[c]=i,S[i]=c,u=x[e],x[e]=x[c],x[c]=u),u=p[e],c=g[e],f=x[e],l[u]=j[e],y[u]=1,++u,i=w.length-1;-1!==i;--i)a=x[o=w[i]],w[i]=0,x[o]=0,o<=e?(d[c]=o,v[c]=a,++c):(l[u]=j[o],y[u]=a/f,++u);p[e+1]=u,g[e+1]=c}for(i=l.length-1;-1!==i;--i)l[i]=S[l[i]];return{L:s,U:h,P:j,Pinv:S}},numeric.ccsDFS0=function ccsDFS0(r){this.k=Array(r),this.k1=Array(r),this.j=Array(r)},numeric.ccsDFS0.prototype.dfs=function dfs(r,n,e,i,o,u,c){var a,f,m,s=0,h=o.length,p=this.k,l=this.k1,y=this.j;if(0===i[r])for(i[r]=1,y[0]=r,p[0]=f=n[u[r]],l[0]=m=n[u[r]+1];;){if(isNaN(f))throw new Error("Ow!");if(f>=m){if(o[h]=u[y[s]],0===s)return;++h,f=p[--s],m=l[s]}else 0===i[a=e[f]]?(i[a]=1,p[s]=f,y[++s]=a,f=n[a=u[a]],l[s]=m=n[a+1]):++f}},numeric.ccsLPSolve0=function ccsLPSolve0(r,n,e,i,o,u,c,a){var f,m,s,h,p,l,y,g,d,v=r[0],x=r[1],w=r[2],b=(v.length,n[0]),M=n[1],j=n[2];for(m=b[o],s=b[o+1],i.length=0,f=m;f<s;++f)a.dfs(M[f],v,x,e,i,u,c);for(f=i.length-1;-1!==f;--f)e[c[h=i[f]]]=0;for(f=m;f!==s;++f)e[h=M[f]]=j[f];for(f=i.length-1;-1!==f;--f){for(g=c[h=i[f]],p=v[h],l=v[h+1],y=p;y<l;++y)if(x[y]===g){e[g]/=w[y];break}for(d=e[g],y=p;y<l;++y)e[x[y]]-=d*w[y];e[g]=d}},numeric.ccsLUP0=function ccsLUP0(r,n){var e,i,o,u,c,a,f,m=r[0].length-1,s=[numeric.rep([m+1],0),[],[]],h=[numeric.rep([m+1],0),[],[]],p=s[0],l=s[1],y=s[2],g=h[0],d=h[1],v=h[2],x=numeric.rep([m],0),w=numeric.rep([m],0),b=numeric.ccsLPSolve0,M=(Math.max,Math.abs),j=numeric.linspace(0,m-1),S=numeric.linspace(0,m-1),V=new numeric.ccsDFS0(m);for(void 0===n&&(n=1),e=0;e<m;++e){for(b(s,r,x,w,e,S,j,V),u=-1,c=-1,i=w.length-1;-1!==i;--i)(o=w[i])<=e||(a=M(x[j[o]]))>u&&(c=o,u=a);for(M(x[j[e]])<n*u&&(i=j[e],u=j[c],j[e]=u,S[u]=e,j[c]=i,S[i]=c),u=p[e],c=g[e],f=x[j[e]],l[u]=j[e],y[u]=1,++u,i=w.length-1;-1!==i;--i)a=x[j[o=w[i]]],w[i]=0,x[j[o]]=0,o<=e?(d[c]=o,v[c]=a,++c):(l[u]=j[o],y[u]=a/f,++u);p[e+1]=u,g[e+1]=c}for(i=l.length-1;-1!==i;--i)l[i]=S[l[i]];return{L:s,U:h,P:j,Pinv:S}},numeric.ccsLUP=numeric.ccsLUP0,numeric.ccsDim=function ccsDim(r){return[numeric.sup(r[1])+1,r[0].length-1]},numeric.ccsGetBlock=function ccsGetBlock(r,n,e){var i=numeric.ccsDim(r),o=i[0],u=i[1];void 0===n?n=numeric.linspace(0,o-1):"number"==typeof n&&(n=[n]),void 0===e?e=numeric.linspace(0,u-1):"number"==typeof e&&(e=[e]);var c,a,f,m,s=n.length,h=e.length,p=numeric.rep([u],0),l=[],y=[],g=[p,l,y],d=r[0],v=r[1],x=r[2],w=numeric.rep([o],0),b=0,M=numeric.rep([o],0);for(a=0;a<h;++a){for(m=e[a],q0=d[m],q1=d[m+1],c=q0;c<q1;++c)M[f=v[c]]=1,w[f]=x[c];for(c=0;c<s;++c)M[n[c]]&&(l[b]=c,y[b]=w[n[c]],++b);for(c=q0;c<q1;++c)M[f=v[c]]=0;p[a+1]=b}return g},numeric.ccsDot=function ccsDot(r,n){var e,i,o,u,c,a,f,m,s,h,p,l=r[0],y=r[1],g=r[2],d=n[0],v=n[1],x=n[2],w=numeric.ccsDim(r),b=numeric.ccsDim(n),M=w[0],j=(w[1],b[1]),S=numeric.rep([M],0),V=numeric.rep([M],0),_=Array(M),q=numeric.rep([j],0),P=[],L=[],N=[q,P,L];for(o=0;o!==j;++o){for(u=d[o],c=d[o+1],s=0,i=u;i<c;++i)for(h=v[i],p=x[i],a=l[h],f=l[h+1],e=a;e<f;++e)0===V[m=y[e]]&&(_[s]=m,V[m]=1,s+=1),S[m]=S[m]+g[e]*p;for(c=(u=q[o])+s,q[o+1]=c,i=s-1;-1!==i;--i)p=u+i,e=_[i],P[p]=e,L[p]=S[e],V[e]=0,S[e]=0;q[o+1]=q[o]+s}return N},numeric.ccsLUPSolve=function ccsLUPSolve(r,n){var e=r.L,i=r.U,o=(r.P,n[0]),u=!1;"object"!=typeof o&&(o=(n=[[0,n.length],numeric.linspace(0,n.length-1),n])[0],u=!0);var c,a,f,m,s,h,p=n[1],l=n[2],y=e[0].length-1,g=o.length-1,d=numeric.rep([y],0),v=Array(y),x=numeric.rep([y],0),w=Array(y),b=numeric.rep([g+1],0),M=[],j=[],S=numeric.ccsTSolve,V=0;for(c=0;c<g;++c){for(s=0,f=o[c],m=o[c+1],a=f;a<m;++a)h=r.Pinv[p[a]],w[s]=h,x[h]=l[a],++s;for(w.length=s,S(e,x,d,w,v),a=w.length-1;-1!==a;--a)x[w[a]]=0;if(S(i,d,x,v,w),u)return x;for(a=v.length-1;-1!==a;--a)d[v[a]]=0;for(a=w.length-1;-1!==a;--a)h=w[a],M[V]=h,j[V]=x[h],x[h]=0,++V;b[c+1]=V}return[b,M,j]},numeric.ccsbinop=function ccsbinop(r,n){return void 0===n&&(n=""),numeric.Function("X","Y","var Xi = X[0], Xj = X[1], Xv = X[2];\nvar Yi = Y[0], Yj = Y[1], Yv = Y[2];\nvar n = Xi.length-1,m = Math.max(numeric.sup(Xj),numeric.sup(Yj))+1;\nvar Zi = numeric.rep([n+1],0), Zj = [], Zv = [];\nvar x = numeric.rep([m],0),y = numeric.rep([m],0);\nvar xk,yk,zk;\nvar i,j,j0,j1,k,p=0;\n"+n+"for(i=0;i<n;++i) {\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Xj[j];\n    x[k] = 1;\n    Zj[p] = k;\n    ++p;\n  }\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Yj[j];\n    y[k] = Yv[j];\n    if(x[k] === 0) {\n      Zj[p] = k;\n      ++p;\n    }\n  }\n  Zi[i+1] = p;\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = Xv[j];\n  j0 = Zi[i]; j1 = Zi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Zj[j];\n    xk = x[k];\n    yk = y[k];\n"+r+"\n    Zv[j] = zk;\n  }\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = 0;\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) y[Yj[j]] = 0;\n}\nreturn [Zi,Zj,Zv];")},function(){var k,A,B,C;for(k in numeric.ops2)A=isFinite(eval("1"+numeric.ops2[k]+"0"))?"[Y[0],Y[1],numeric."+k+"(X,Y[2])]":"NaN",B=isFinite(eval("0"+numeric.ops2[k]+"1"))?"[X[0],X[1],numeric."+k+"(X[2],Y)]":"NaN",C=isFinite(eval("1"+numeric.ops2[k]+"0"))&&isFinite(eval("0"+numeric.ops2[k]+"1"))?"numeric.ccs"+k+"MM(X,Y)":"NaN",numeric["ccs"+k+"MM"]=numeric.ccsbinop("zk = xk "+numeric.ops2[k]+"yk;"),numeric["ccs"+k]=numeric.Function("X","Y",'if(typeof X === "number") return '+A+';\nif(typeof Y === "number") return '+B+";\nreturn "+C+";\n")}(),numeric.ccsScatter=function ccsScatter(r){var n,e=r[0],i=r[1],o=r[2],u=numeric.sup(i)+1,c=e.length,a=numeric.rep([u],0),f=Array(c),m=Array(c),s=numeric.rep([u],0);for(n=0;n<c;++n)s[i[n]]++;for(n=0;n<u;++n)a[n+1]=a[n]+s[n];var h,p,l=a.slice(0);for(n=0;n<c;++n)f[h=l[p=i[n]]]=e[n],m[h]=o[n],l[p]=l[p]+1;return[a,f,m]},numeric.ccsGather=function ccsGather(r){var n,e,i,o,u,c=r[0],a=r[1],f=r[2],m=c.length-1,s=a.length,h=Array(s),p=Array(s),l=Array(s);for(u=0,n=0;n<m;++n)for(i=c[n],o=c[n+1],e=i;e!==o;++e)p[u]=n,h[u]=a[e],l[u]=f[e],++u;return[h,p,l]},numeric.sdim=function dim(r,n,e){if(void 0===n&&(n=[]),"object"!=typeof r)return n;var i;for(i in void 0===e&&(e=0),e in n||(n[e]=0),r.length>n[e]&&(n[e]=r.length),r)r.hasOwnProperty(i)&&dim(r[i],n,e+1);return n},numeric.sclone=function clone(r,n,e){void 0===n&&(n=0),void 0===e&&(e=numeric.sdim(r).length);var i,o=Array(r.length);if(n===e-1){for(i in r)r.hasOwnProperty(i)&&(o[i]=r[i]);return o}for(i in r)r.hasOwnProperty(i)&&(o[i]=clone(r[i],n+1,e));return o},numeric.sdiag=function diag(r){var n,e,i=r.length,o=Array(i);for(n=i-1;n>=1;n-=2)e=n-1,o[n]=[],o[n][n]=r[n],o[e]=[],o[e][e]=r[e];return 0===n&&(o[0]=[],o[0][0]=r[n]),o},numeric.sidentity=function identity(r){return numeric.sdiag(numeric.rep([r],1))},numeric.stranspose=function transpose(r){var n,e,i,o=[];r.length;for(n in r)if(r.hasOwnProperty(n))for(e in i=r[n])i.hasOwnProperty(e)&&("object"!=typeof o[e]&&(o[e]=[]),o[e][n]=i[e]);return o},numeric.sLUP=function LUP(r,n){throw new Error("The function numeric.sLUP had a bug in it and has been removed. Please use the new numeric.ccsLUP function instead.")},numeric.sdotMM=function dotMM(r,n){var e,i,o,u,c,a,f,m=r.length,s=(n.length,numeric.stranspose(n)),h=s.length,p=Array(m);for(o=m-1;o>=0;o--){for(f=[],e=r[o],c=h-1;c>=0;c--){for(u in a=0,i=s[c],e)e.hasOwnProperty(u)&&u in i&&(a+=e[u]*i[u]);a&&(f[c]=a)}p[o]=f}return p},numeric.sdotMV=function dotMV(r,n){var e,i,o,u,c=r.length,a=Array(c);for(i=c-1;i>=0;i--){for(o in u=0,e=r[i])e.hasOwnProperty(o)&&n[o]&&(u+=e[o]*n[o]);u&&(a[i]=u)}return a},numeric.sdotVM=function dotMV(r,n){var e,i,o,u,c=[];for(e in r)if(r.hasOwnProperty(e))for(i in o=n[e],u=r[e],o)o.hasOwnProperty(i)&&(c[i]||(c[i]=0),c[i]+=u*o[i]);return c},numeric.sdotVV=function dotVV(r,n){var e,i=0;for(e in r)r[e]&&n[e]&&(i+=r[e]*n[e]);return i},numeric.sdot=function dot(r,n){var e=numeric.sdim(r).length,i=numeric.sdim(n).length;switch(1e3*e+i){case 0:return r*n;case 1001:return numeric.sdotVV(r,n);case 2001:return numeric.sdotMV(r,n);case 1002:return numeric.sdotVM(r,n);case 2002:return numeric.sdotMM(r,n);default:throw new Error("numeric.sdot not implemented for tensors of order "+e+" and "+i)}},numeric.sscatter=function scatter(r){var n,e,i,o,u=r[0].length,c=r.length,a=[];for(e=u-1;e>=0;--e)if(r[c-1][e]){for(o=a,i=0;i<c-2;i++)o[n=r[i][e]]||(o[n]=[]),o=o[n];o[r[i][e]]=r[i+1][e]}return a},numeric.sgather=function gather(r,n,e){var i,o,u;for(o in void 0===n&&(n=[]),void 0===e&&(e=[]),i=e.length,r)if(r.hasOwnProperty(o))if(e[i]=parseInt(o),"number"==typeof(u=r[o])){if(u){if(0===n.length)for(o=i+1;o>=0;--o)n[o]=[];for(o=i;o>=0;--o)n[o].push(e[o]);n[i+1].push(u)}}else gather(u,n,e);return e.length>i&&e.pop(),n},numeric.cLU=function LU(r){var n,e,i,o,u,c,a=r[0],f=r[1],m=r[2],s=a.length,h=0;for(n=0;n<s;n++)a[n]>h&&(h=a[n]);h++;var p,l=Array(h),y=Array(h),g=numeric.rep([h],1/0),d=numeric.rep([h],-1/0);for(i=0;i<s;i++)n=a[i],(e=f[i])<g[n]&&(g[n]=e),e>d[n]&&(d[n]=e);for(n=0;n<h-1;n++)d[n]>d[n+1]&&(d[n+1]=d[n]);for(n=h-1;n>=1;n--)g[n]<g[n-1]&&(g[n-1]=g[n]);for(n=0;n<h;n++)y[n]=numeric.rep([d[n]-g[n]+1],0),l[n]=numeric.rep([n-g[n]],0),n-g[n]+1,d[n]-n+1;for(i=0;i<s;i++)y[n=a[i]][f[i]-g[n]]=m[i];for(n=0;n<h-1;n++)for(o=n-g[n],w=y[n],e=n+1;g[e]<=n&&e<h;e++)if(u=n-g[e],c=d[n]-n,p=(b=y[e])[u]/w[o]){for(i=1;i<=c;i++)b[i+u]-=p*w[i+o];l[e][n-g[e]]=p}var v,x,w=[],b=[],M=[],j=[],S=[],V=[];for(s=0,v=0,n=0;n<h;n++){for(o=g[n],u=d[n],x=y[n],e=n;e<=u;e++)x[e-o]&&(w[s]=n,b[s]=e,M[s]=x[e-o],s++);for(x=l[n],e=o;e<n;e++)x[e-o]&&(j[v]=n,S[v]=e,V[v]=x[e-o],v++);j[v]=n,S[v]=n,V[v]=1,v++}return{U:[w,b,M],L:[j,S,V]}},numeric.cLUsolve=function LUsolve(r,n){var e,i,o=r.L,u=r.U,c=numeric.clone(n),a=o[0],f=o[1],m=o[2],s=u[0],h=u[1],p=u[2],l=s.length,y=(a.length,c.length);for(i=0,e=0;e<y;e++){for(;f[i]<e;)c[e]-=m[i]*c[f[i]],i++;i++}for(i=l-1,e=y-1;e>=0;e--){for(;h[i]>e;)c[e]-=p[i]*c[h[i]],i--;c[e]/=p[i],i--}return c},numeric.cgrid=function grid(r,n){"number"==typeof r&&(r=[r,r]);var e,i,o,u=numeric.rep(r,-1);if("function"!=typeof n)switch(n){case"L":n=function(n,e){return n>=r[0]/2||e<r[1]/2};break;default:n=function(r,n){return!0}}for(o=0,e=1;e<r[0]-1;e++)for(i=1;i<r[1]-1;i++)n(e,i)&&(u[e][i]=o,o++);return u},numeric.cdelsq=function delsq(r){var n,e,i,o,u,c=[[-1,0],[0,-1],[0,1],[1,0]],a=numeric.dim(r),f=a[0],m=a[1],s=[],h=[],p=[];for(n=1;n<f-1;n++)for(e=1;e<m-1;e++)if(!(r[n][e]<0)){for(i=0;i<4;i++)o=n+c[i][0],u=e+c[i][1],r[o][u]<0||(s.push(r[n][e]),h.push(r[o][u]),p.push(-1));s.push(r[n][e]),h.push(r[n][e]),p.push(4)}return[s,h,p]},numeric.cdotMV=function dotMV(r,n){var e,i,o,u=r[0],c=r[1],a=r[2],f=u.length;for(o=0,i=0;i<f;i++)u[i]>o&&(o=u[i]);for(o++,e=numeric.rep([o],0),i=0;i<f;i++)e[u[i]]+=a[i]*n[c[i]];return e},numeric.Spline=function Spline(r,n,e,i,o){this.x=r,this.yl=n,this.yr=e,this.kl=i,this.kr=o},numeric.Spline.prototype._at=function _at(r,n){var e,i,o,u=this.x,c=this.yl,a=this.yr,f=this.kl,m=this.kr,s=numeric.add,h=numeric.sub,p=numeric.mul;e=h(p(f[n],u[n+1]-u[n]),h(a[n+1],c[n])),i=s(p(m[n+1],u[n]-u[n+1]),h(a[n+1],c[n]));var l=(o=(r-u[n])/(u[n+1]-u[n]))*(1-o);return s(s(s(p(1-o,c[n]),p(o,a[n+1])),p(e,l*(1-o))),p(i,l*o))},numeric.Spline.prototype.at=function at(r){if("number"==typeof r){var n,e,i,o=this.x,u=o.length,c=Math.floor;for(n=0,e=u-1;e-n>1;)o[i=c((n+e)/2)]<=r?n=i:e=i;return this._at(r,n)}u=r.length;var a,f=Array(u);for(a=u-1;-1!==a;--a)f[a]=this.at(r[a]);return f},numeric.Spline.prototype.diff=function diff(){var r,n,e,i=this.x,o=this.yl,u=this.yr,c=this.kl,a=this.kr,f=o.length,m=c,s=a,h=Array(f),p=Array(f),l=numeric.add,y=numeric.mul,g=numeric.div,d=numeric.sub;for(r=f-1;-1!==r;--r)n=i[r+1]-i[r],e=d(u[r+1],o[r]),h[r]=g(l(y(e,6),y(c[r],-4*n),y(a[r+1],-2*n)),n*n),p[r+1]=g(l(y(e,-6),y(c[r],2*n),y(a[r+1],4*n)),n*n);return new numeric.Spline(i,m,s,h,p)},numeric.Spline.prototype.roots=function roots(){function sqr(r){return r*r}var r=[],n=this.x,e=this.yl,i=this.yr,o=this.kl,u=this.kr;"number"==typeof e[0]&&(e=[e],i=[i],o=[o],u=[u]);var c,a,f,m,s,h,p,l,y,g,d,v,x,w,b,M,j,S,V,_,q,P,L,N=e.length,F=n.length-1,U=(r=Array(N),Math.sqrt);for(c=0;c!==N;++c){for(m=e[c],s=i[c],h=o[c],p=u[c],l=[],a=0;a!==F;a++){for(a>0&&s[a]*m[a]<0&&l.push(n[a]),M=n[a+1]-n[a],n[a],d=m[a],v=s[a+1],y=h[a]/M,x=(g=p[a+1]/M)+3*d+2*y-3*v,w=3*(g+y+2*(d-v)),(b=sqr(y-g+3*(d-v))+12*g*d)<=0?j=(S=x/w)>n[a]&&S<n[a+1]?[n[a],S,n[a+1]]:[n[a],n[a+1]]:(S=(x-U(b))/w,V=(x+U(b))/w,j=[n[a]],S>n[a]&&S<n[a+1]&&j.push(S),V>n[a]&&V<n[a+1]&&j.push(V),j.push(n[a+1])),q=j[0],S=this._at(q,a),f=0;f<j.length-1;f++)if(P=j[f+1],V=this._at(P,a),0!==S)if(0===V||S*V>0)q=P,S=V;else{for(var D=0;!((L=(S*P-V*q)/(S-V))<=q||L>=P);)if((_=this._at(L,a))*V>0)P=L,V=_,-1===D&&(S*=.5),D=-1;else{if(!(_*S>0))break;q=L,S=_,1===D&&(V*=.5),D=1}l.push(L),q=j[f+1],S=this._at(q,a)}else l.push(q),q=P,S=V;0===V&&l.push(P)}r[c]=l}return"number"==typeof this.yl[0]?r[0]:r},numeric.spline=function spline(r,n,e,i){var o,u=r.length,c=[],a=[],f=[],m=numeric.sub,s=numeric.mul,h=numeric.add;for(o=u-2;o>=0;o--)a[o]=r[o+1]-r[o],f[o]=m(n[o+1],n[o]);"string"!=typeof e&&"string"!=typeof i||(e=i="periodic");var p=[[],[],[]];switch(typeof e){case"undefined":c[0]=s(3/(a[0]*a[0]),f[0]),p[0].push(0,0),p[1].push(0,1),p[2].push(2/a[0],1/a[0]);break;case"string":c[0]=h(s(3/(a[u-2]*a[u-2]),f[u-2]),s(3/(a[0]*a[0]),f[0])),p[0].push(0,0,0),p[1].push(u-2,0,1),p[2].push(1/a[u-2],2/a[u-2]+2/a[0],1/a[0]);break;default:c[0]=e,p[0].push(0),p[1].push(0),p[2].push(1)}for(o=1;o<u-1;o++)c[o]=h(s(3/(a[o-1]*a[o-1]),f[o-1]),s(3/(a[o]*a[o]),f[o])),p[0].push(o,o,o),p[1].push(o-1,o,o+1),p[2].push(1/a[o-1],2/a[o-1]+2/a[o],1/a[o]);switch(typeof i){case"undefined":c[u-1]=s(3/(a[u-2]*a[u-2]),f[u-2]),p[0].push(u-1,u-1),p[1].push(u-2,u-1),p[2].push(1/a[u-2],2/a[u-2]);break;case"string":p[1][p[1].length-1]=0;break;default:c[u-1]=i,p[0].push(u-1),p[1].push(u-1),p[2].push(1)}c="number"!=typeof c[0]?numeric.transpose(c):[c];var l=Array(c.length);if("string"==typeof e)for(o=l.length-1;-1!==o;--o)l[o]=numeric.ccsLUPSolve(numeric.ccsLUP(numeric.ccsScatter(p)),c[o]),l[o][u-1]=l[o][0];else for(o=l.length-1;-1!==o;--o)l[o]=numeric.cLUsolve(numeric.cLU(p),c[o]);return l="number"==typeof n[0]?l[0]:numeric.transpose(l),new numeric.Spline(r,n,n,l,l)},numeric.fftpow2=function fftpow2(r,n){var e=r.length;if(1!==e){var i,o,u=Math.cos,c=Math.sin,a=Array(e/2),f=Array(e/2),m=Array(e/2),s=Array(e/2);for(o=e/2,i=e-1;-1!==i;--i)m[--o]=r[i],s[o]=n[i],--i,a[o]=r[i],f[o]=n[i];fftpow2(a,f),fftpow2(m,s),o=e/2;var h,p,l,y=-6.283185307179586/e;for(i=e-1;-1!==i;--i)-1===--o&&(o=e/2-1),p=u(h=y*i),l=c(h),r[i]=a[o]+p*m[o]-l*s[o],n[i]=f[o]+p*s[o]+l*m[o]}},numeric._ifftpow2=function _ifftpow2(r,n){var e=r.length;if(1!==e){var i,o,u=Math.cos,c=Math.sin,a=Array(e/2),f=Array(e/2),m=Array(e/2),s=Array(e/2);for(o=e/2,i=e-1;-1!==i;--i)m[--o]=r[i],s[o]=n[i],--i,a[o]=r[i],f[o]=n[i];_ifftpow2(a,f),_ifftpow2(m,s),o=e/2;var h,p,l,y=6.283185307179586/e;for(i=e-1;-1!==i;--i)-1===--o&&(o=e/2-1),p=u(h=y*i),l=c(h),r[i]=a[o]+p*m[o]-l*s[o],n[i]=f[o]+p*s[o]+l*m[o]}},numeric.ifftpow2=function ifftpow2(r,n){numeric._ifftpow2(r,n),numeric.diveq(r,r.length),numeric.diveq(n,n.length)},numeric.convpow2=function convpow2(r,n,e,i){var o,u,c,a,f;for(numeric.fftpow2(r,n),numeric.fftpow2(e,i),o=r.length-1;-1!==o;--o)u=r[o],a=n[o],c=e[o],f=i[o],r[o]=u*c-a*f,n[o]=u*f+a*c;numeric.ifftpow2(r,n)},numeric.T.prototype.fft=function fft(){var r,n,e=this.x,i=this.y,o=e.length,u=Math.log,c=u(2),a=Math.ceil(u(2*o-1)/c),f=Math.pow(2,a),m=numeric.rep([f],0),s=numeric.rep([f],0),h=Math.cos,p=Math.sin,l=-3.141592653589793/o,y=numeric.rep([f],0),g=numeric.rep([f],0);Math.floor(o/2);for(r=0;r<o;r++)y[r]=e[r];if(void 0!==i)for(r=0;r<o;r++)g[r]=i[r];for(m[0]=1,r=1;r<=f/2;r++)n=l*r*r,m[r]=h(n),s[r]=p(n),m[f-r]=h(n),s[f-r]=p(n);var d=new numeric.T(y,g),v=new numeric.T(m,s);return d=d.mul(v),numeric.convpow2(d.x,d.y,numeric.clone(v.x),numeric.neg(v.y)),(d=d.mul(v)).x.length=o,d.y.length=o,d},numeric.T.prototype.ifft=function ifft(){var r,n,e=this.x,i=this.y,o=e.length,u=Math.log,c=u(2),a=Math.ceil(u(2*o-1)/c),f=Math.pow(2,a),m=numeric.rep([f],0),s=numeric.rep([f],0),h=Math.cos,p=Math.sin,l=3.141592653589793/o,y=numeric.rep([f],0),g=numeric.rep([f],0);Math.floor(o/2);for(r=0;r<o;r++)y[r]=e[r];if(void 0!==i)for(r=0;r<o;r++)g[r]=i[r];for(m[0]=1,r=1;r<=f/2;r++)n=l*r*r,m[r]=h(n),s[r]=p(n),m[f-r]=h(n),s[f-r]=p(n);var d=new numeric.T(y,g),v=new numeric.T(m,s);return d=d.mul(v),numeric.convpow2(d.x,d.y,numeric.clone(v.x),numeric.neg(v.y)),(d=d.mul(v)).x.length=o,d.y.length=o,d.div(o)},numeric.gradient=function gradient(r,n){var e=n.length,i=r(n);if(isNaN(i))throw new Error("gradient: f(x) is a NaN!");var o,u,c,a,f,m,s,h,p,l=Math.max,y=numeric.clone(n),g=Array(e),d=(numeric.div,numeric.sub,l=Math.max,Math.abs),v=Math.min,x=0;for(o=0;o<e;o++)for(var w=l(1e-6*i,1e-8);;){if(++x>20)throw new Error("Numerical gradient fails");if(y[o]=n[o]+w,u=r(y),y[o]=n[o]-w,c=r(y),y[o]=n[o],isNaN(u)||isNaN(c))w/=16;else{if(g[o]=(u-c)/(2*w),a=n[o]-w,f=n[o],m=n[o]+w,s=(u-i)/w,h=(i-c)/w,p=l(d(g[o]),d(i),d(u),d(c),d(a),d(f),d(m),1e-8),!(v(l(d(s-g[o]),d(h-g[o]),d(s-h))/p,w/p)>.001))break;w/=16}}return g},numeric.uncmin=function uncmin(r,n,e,i,o,u,c){var a=numeric.gradient;void 0===c&&(c={}),void 0===e&&(e=1e-8),void 0===i&&(i=function(n){return a(r,n)}),void 0===o&&(o=1e3);var f,m,s=(n=numeric.clone(n)).length,h=r(n);if(isNaN(h))throw new Error("uncmin: f(x0) is a NaN!");var p=Math.max,l=numeric.norm2;e=p(e,numeric.epsilon);var y,g,d,v,x,w,b,M,j,S,V=c.Hinv||numeric.identity(s),_=numeric.dot,q=(numeric.inv,numeric.sub),P=numeric.add,L=numeric.tensor,N=numeric.div,F=numeric.mul,U=numeric.all,D=numeric.isFinite,R=numeric.neg,O=0,X="";for(g=i(n);O<o;){if("function"==typeof u&&u(O,n,h,g,V)){X="Callback returned true";break}if(!U(D(g))){X="Gradient has Infinity or NaN";break}if(!U(D(y=R(_(V,g))))){X="Search direction has Infinity or NaN";break}if((S=l(y))<e){X="Newton step smaller than tol";break}for(j=1,m=_(g,y),x=n;O<o&&!(j*S<e)&&(x=P(n,v=F(y,j)),(f=r(x))-h>=.1*j*m||isNaN(f));)j*=.5,++O;if(j*S<e){X="Line search step size smaller than tol";break}if(O===o){X="maxit reached during line search";break}M=_(w=q(d=i(x),g),v),b=_(V,w),V=q(P(V,F((M+_(w,b))/(M*M),L(v,v))),N(P(L(b,v),L(v,b)),M)),n=x,h=f,g=d,++O}return{solution:n,f:h,gradient:g,invHessian:V,iterations:O,message:X}},numeric.Dopri=function Dopri(r,n,e,i,o,u,c){this.x=r,this.y=n,this.f=e,this.ymid=i,this.iterations=o,this.events=c,this.message=u},numeric.Dopri.prototype._at=function _at(r,n){function sqr(r){return r*r}var e,i,o,u,c,a,f,m,s,h=this,p=h.x,l=h.y,y=h.f,g=h.ymid,d=(p.length,Math.floor,numeric.add),v=numeric.mul,x=numeric.sub;return e=p[n],i=p[n+1],u=l[n],c=l[n+1],o=e+.5*(i-e),a=g[n],f=x(y[n],v(u,1/(e-o)+2/(e-i))),m=x(y[n+1],v(c,1/(i-o)+2/(i-e))),d(d(d(d(v(u,(s=[sqr(r-i)*(r-o)/sqr(e-i)/(e-o),sqr(r-e)*sqr(r-i)/sqr(e-o)/sqr(i-o),sqr(r-e)*(r-o)/sqr(i-e)/(i-o),(r-e)*sqr(r-i)*(r-o)/sqr(e-i)/(e-o),(r-i)*sqr(r-e)*(r-o)/sqr(e-i)/(i-o)])[0]),v(a,s[1])),v(c,s[2])),v(f,s[3])),v(m,s[4]))},numeric.Dopri.prototype.at=function at(r){var n,e,i,o=Math.floor;if("number"!=typeof r){var u=r.length,c=Array(u);for(n=u-1;-1!==n;--n)c[n]=this.at(r[n]);return c}var a=this.x;for(n=0,e=a.length-1;e-n>1;)a[i=o(.5*(n+e))]<=r?n=i:e=i;return this._at(r,n)},numeric.dopri=function dopri(r,n,e,i,o,u,c){void 0===o&&(o=1e-6),void 0===u&&(u=1e3);var a,f,m,s,h,p,l,y,g,d,v,x,w,b=[r],M=[e],j=[i(r,e)],S=[],V=[3/40,9/40],_=[44/45,-56/15,32/9],q=[19372/6561,-25360/2187,64448/6561,-212/729],P=[9017/3168,-355/33,46732/5247,49/176,-5103/18656],L=[35/384,0,500/1113,125/192,-2187/6784,11/84],N=[.10013431883002395,0,.3918321794184259,-.02982460176594817,.05893268337240795,-.04497888809104361,5618549.5/235043384],F=[.2,.3,.8,8/9,1,1],U=[-71/57600,0,71/16695,-71/1920,17253/339200,-22/525,1/40],D=0,R=(n-r)/10,O=0,X=numeric.add,E=numeric.mul,Y=(Math.max,Math.min),z=Math.abs,Q=numeric.norminf,I=Math.pow,Z=numeric.any,H=numeric.lt,G=numeric.and,W=(numeric.sub,new numeric.Dopri(b,M,j,S,-1,""));for("function"==typeof c&&(v=c(r,e));r<n&&O<u;)if(++O,r+R>n&&(R=n-r),a=i(r+F[0]*R,X(e,E(.2*R,j[D]))),f=i(r+F[1]*R,X(X(e,E(V[0]*R,j[D])),E(V[1]*R,a))),m=i(r+F[2]*R,X(X(X(e,E(_[0]*R,j[D])),E(_[1]*R,a)),E(_[2]*R,f))),s=i(r+F[3]*R,X(X(X(X(e,E(q[0]*R,j[D])),E(q[1]*R,a)),E(q[2]*R,f)),E(q[3]*R,m))),h=i(r+F[4]*R,X(X(X(X(X(e,E(P[0]*R,j[D])),E(P[1]*R,a)),E(P[2]*R,f)),E(P[3]*R,m)),E(P[4]*R,s))),p=i(r+R,g=X(X(X(X(X(e,E(j[D],R*L[0])),E(f,R*L[2])),E(m,R*L[3])),E(s,R*L[4])),E(h,R*L[5]))),(d="number"==typeof(l=X(X(X(X(X(E(j[D],R*U[0]),E(f,R*U[2])),E(m,R*U[3])),E(s,R*U[4])),E(h,R*U[5])),E(p,R*U[6])))?z(l):Q(l))>o){if(r+(R=.2*R*I(o/d,.25))===r){W.msg="Step size became too small";break}}else{if(S[D]=X(X(X(X(X(X(e,E(j[D],R*N[0])),E(f,R*N[2])),E(m,R*N[3])),E(s,R*N[4])),E(h,R*N[5])),E(p,R*N[6])),b[++D]=r+R,M[D]=g,j[D]=p,"function"==typeof c){var $,J,K=r,rr=r+.5*R;if(x=c(rr,S[D-1]),Z(w=G(H(v,0),H(0,x)))||(K=rr,v=x,x=c(rr=r+R,g),w=G(H(v,0),H(0,x))),Z(w)){for(var nr,er,ir=0,tr=1,or=1;;){if("number"==typeof v)J=(or*x*K-tr*v*rr)/(or*x-tr*v);else for(J=rr,y=v.length-1;-1!==y;--y)v[y]<0&&x[y]>0&&(J=Y(J,(or*x[y]*K-tr*v[y]*rr)/(or*x[y]-tr*v[y])));if(J<=K||J>=rr)break;er=c(J,$=W._at(J,D-1)),Z(nr=G(H(v,0),H(0,er)))?(rr=J,x=er,w=nr,or=1,-1===ir?tr*=.5:tr=1,ir=-1):(K=J,v=er,tr=1,1===ir?or*=.5:or=1,ir=1)}return g=W._at(.5*(r+J),D-1),W.f[D]=i(J,$),W.x[D]=J,W.y[D]=$,W.ymid[D-1]=g,W.events=w,W.iterations=O,W}}r+=R,e=g,v=x,R=Y(.8*R*I(o/d,.25),4*R)}return W.iterations=O,W},numeric.LU=function(r,n){n=n||!1;var e,i,o,u,c,a,f,m,s,h=Math.abs,p=r.length,l=p-1,y=new Array(p);for(n||(r=numeric.clone(r)),o=0;o<p;++o){for(f=o,s=h((a=r[o])[o]),i=o+1;i<p;++i)s<(u=h(r[i][o]))&&(s=u,f=i);for(y[o]=f,f!=o&&(r[o]=r[f],r[f]=a,a=r[o]),c=a[o],e=o+1;e<p;++e)r[e][o]/=c;for(e=o+1;e<p;++e){for(m=r[e],i=o+1;i<l;++i)m[i]-=m[o]*a[i],m[++i]-=m[o]*a[i];i===l&&(m[i]-=m[o]*a[i])}}return{LU:r,P:y}},numeric.LUsolve=function LUsolve(r,n){var e,i,o,u,c=r.LU,a=c.length,f=numeric.clone(n),m=r.P;for(e=a-1;-1!==e;--e)f[e]=n[e];for(e=0;e<a;++e)for(o=m[e],m[e]!==e&&(tmp=f[e],f[e]=f[o],f[o]=tmp),u=c[e],i=0;i<e;++i)f[e]-=f[i]*u[i];for(e=a-1;e>=0;--e){for(u=c[e],i=e+1;i<a;++i)f[e]-=f[i]*u[i];f[e]/=u[e]}return f},numeric.solve=function solve(r,n,e){return numeric.LUsolve(numeric.LU(r,e),n)},numeric.echelonize=function echelonize(r){var n,e,i,o,u,c,a,f,m=numeric.dim(r),s=m[0],h=m[1],p=numeric.identity(s),l=Array(s),y=Math.abs,g=numeric.diveq;for(r=numeric.clone(r),n=0;n<s;++n){for(i=0,u=r[n],c=p[n],e=1;e<h;++e)y(u[i])<y(u[e])&&(i=e);for(l[n]=i,g(c,u[i]),g(u,u[i]),e=0;e<s;++e)if(e!==n){for(f=(a=r[e])[i],o=h-1;-1!==o;--o)a[o]-=u[o]*f;for(a=p[e],o=s-1;-1!==o;--o)a[o]-=c[o]*f}}return{I:p,A:r,P:l}},numeric._solveLP=function _solveLP(r,n,e,i,o,u){var c,a,f=numeric.sum,m=(numeric.log,numeric.mul),s=numeric.sub,h=numeric.dot,p=numeric.div,l=numeric.add,y=r.length,d=e.length,v=!1,x=0;if(void 0===i&&(i=numeric.epsilon),void 0===o&&(o=1e3),void 0===u){var w=numeric.rep([y],0).concat([1]),b=numeric.rep([d,1],-1),M=_solveLP(w,F=numeric.blockMatrix([[n,b]]),e,i,o,c=numeric.rep([y],0).concat(Math.max(0,numeric.sup(numeric.neg(e)))+1));if((u=numeric.clone(M.solution)).length=y,numeric.inf(s(e,h(n,u)))<0)return{solution:NaN,message:"Infeasible",iterations:M.iterations};x=M.iterations,a=function cb(e,i,o,u,c){var a,f=h(r,u),m=h(n,u);for(a=d-1;-1!==a;--a)if(f*m[a]<0)return!1;return v=!0,!0}}else a=function cb(r,n,e,i,o){return!(n[y-1]>=0)&&(v=!0,!0)};var j=1,S=(numeric.transpose(n),numeric.svd,numeric.transpose),V=numeric.leq,_=(numeric.muleq,numeric.norminf,numeric.any),q=Math.min;j=1;var P,L,N=Array(y),F=Array(d),U=(numeric.rep([d],1),numeric.solve),D=s(e,h(n,u));for(L=x;L<o;++L){var R,O;for(R=d-1;-1!==R;--R)F[R]=p(n[R],D[R]);var X=S(F);for(R=y-1;-1!==R;--R)N[R]=u[R]+f(X[R]);for(j=.25*Math.abs(h(r,r)/h(r,N)),g=l(r,m(j,N)),P=h(X,F),R=y-1;-1!==R;--R)P[R][R]+=1;O=U(P=m(P,j),g,!0);var E=p(D,h(n,O)),Y=1;for(R=d-1;-1!==R;--R)E[R]<0&&(Y=q(Y,-.999*E[R]));if(c=s(u,m(O,Y)),_(V(D=s(e,h(n,c)),0)))return{solution:u,message:"",iterations:L};if(j<i)return{solution:c,message:"",iterations:L};if(a(0,u=c,0,g,P),v)return{solution:c,message:"Unbounded",iterations:L}}return{solution:u,message:"maximum iteration count exceeded",iterations:L}},numeric.solveLP=function solveLP(r,n,e,i,o,u,c){if(void 0===i)return numeric._solveLP(r,n,e,u,c,D);var a,f=i.length,m=i[0].length,s=n.length,h=numeric.echelonize(i),p=numeric.rep([m],0),l=h.P,y=[];for(a=l.length-1;-1!==a;--a)p[l[a]]=1;for(a=m-1;-1!==a;--a)0===p[a]&&y.push(a);var g=numeric.getRange,d=numeric.linspace(0,f-1),v=numeric.linspace(0,s-1),x=g(i,d,y),w=g(n,v,l),b=g(n,v,y),M=numeric.dot,j=numeric.sub,S=M(w,h.I),V=j(b,M(S,x)),_=j(e,M(S,o)),q=Array(l.length),P=Array(y.length);for(a=l.length-1;-1!==a;--a)q[a]=r[l[a]];for(a=y.length-1;-1!==a;--a)P[a]=r[y[a]];var L=j(P,M(q,M(h.I,x))),N=numeric._solveLP(L,V,_,u,c),F=N.solution,U=M(h.I,j(o,M(x,F))),D=Array(r.length);for(a=l.length-1;-1!==a;--a)D[l[a]]=U[a];for(a=y.length-1;-1!==a;--a)D[y[a]]=F[a];return{solution:D,message:N.message,iterations:N.iterations}},numeric.MPStoLP=function MPStoLP(r){r instanceof String&&r.split("\n");var n,e,i,o,u=0,c=["Initial state","NAME","ROWS","COLUMNS","RHS","BOUNDS","ENDATA"],a=r.length,f=0,m={},s=[],h=0,p={},l=0,y=[],g=[],d=[];function err(e){throw new Error("MPStoLP: "+e+"\nLine "+n+": "+r[n]+"\nCurrent state: "+c[u]+"\n")}for(n=0;n<a;++n){var v=(i=r[n]).match(/\S*/g),x=[];for(e=0;e<v.length;++e)""!==v[e]&&x.push(v[e]);if(0!==x.length){for(e=0;e<c.length&&i.substr(0,c[e].length)!==c[e];++e);if(e<c.length){if(u=e,1===e&&(o=x[1]),6===e)return{name:o,c:y,A:numeric.transpose(g),b:d,rows:m,vars:p}}else switch(u){case 0:case 1:err("Unexpected line");case 2:switch(x[0]){case"N":0===f?f=x[1]:err("Two or more N rows");break;case"L":m[x[1]]=h,s[h]=1,d[h]=0,++h;break;case"G":m[x[1]]=h,s[h]=-1,d[h]=0,++h;break;case"E":m[x[1]]=h,s[h]=0,d[h]=0,++h;break;default:err("Parse error "+numeric.prettyPrint(x))}break;case 3:p.hasOwnProperty(x[0])||(p[x[0]]=l,y[l]=0,g[l]=numeric.rep([h],0),++l);var w=p[x[0]];for(e=1;e<x.length;e+=2)if(x[e]!==f){var b=m[x[e]];g[w][b]=(s[b]<0?-1:1)*parseFloat(x[e+1])}else y[w]=parseFloat(x[e+1]);break;case 4:for(e=1;e<x.length;e+=2)d[m[x[e]]]=(s[m[x[e]]]<0?-1:1)*parseFloat(x[e+1]);break;case 5:break;case 6:err("Internal error")}}}err("Reached end of file without ENDATA")},numeric.seedrandom={pow:Math.pow,random:Math.random},function(r,n,e,i,o,u,c){function ARC4(r){var n,i,o=this,u=r.length,c=0,a=o.i=o.j=o.m=0;for(o.S=[],o.c=[],u||(r=[u++]);c<e;)o.S[c]=c++;for(c=0;c<e;c++)a=lowbits(a+(n=o.S[c])+r[c%u]),i=o.S[a],o.S[c]=i,o.S[a]=n;o.g=function getnext(r){var n=o.S,i=lowbits(o.i+1),u=n[i],c=lowbits(o.j+u),a=n[c];n[i]=a,n[c]=u;for(var f=n[lowbits(u+a)];--r;)i=lowbits(i+1),a=n[c=lowbits(c+(u=n[i]))],n[i]=a,n[c]=u,f=f*e+n[lowbits(u+a)];return o.i=i,o.j=c,f},o.g(e)}function flatten(r,n,e,i,o){if(e=[],o=typeof r,n&&"object"==o)for(i in r)if(i.indexOf("S")<5)try{e.push(flatten(r[i],n-1))}catch(r){}return e.length?e:r+("string"!=o?"\0":"")}function mixkey(r,n,e,i){for(r+="",e=0,i=0;i<r.length;i++)n[lowbits(i)]=lowbits((e^=19*n[lowbits(i)])+r.charCodeAt(i));for(i in r="",n)r+=String.fromCharCode(n[i]);return r}function lowbits(r){return 255&r}n.seedrandom=function seedrandom(i,a){var f,m=[];return i=mixkey(flatten(a?[i,r]:arguments.length?i:[(new Date).getTime(),r,window],3),m),mixkey((f=new ARC4(m)).S,r),n.random=function random(){for(var r=f.g(6),n=c,i=0;r<o;)r=(r+i)*e,n*=e,i=f.g(1);for(;r>=u;)r/=2,n/=2,i>>>=1;return(r+i)/n},i},c=n.pow(e,6),o=n.pow(2,o),u=2*o,mixkey(n.random(),r)}([],numeric.seedrandom,256,0,52),function(r){function base0to1(r){if("object"!=typeof r)return r;var n,e=[],i=r.length;for(n=0;n<i;n++)e[n+1]=base0to1(r[n]);return e}function base1to0(r){if("object"!=typeof r)return r;var n,e=[],i=r.length;for(n=1;n<i;n++)e[n-1]=base1to0(r[n]);return e}function qpgen2(r,n,e,i,o,u,c,a,f,m,s,h,p,l,y,g){var d,v,x,w,b,M,j,S,V,_,q,P,L,N,F,U,D,R,O,X,E,Y,z,Q,I,Z,H;L=Math.min(i,m),x=2*i+L*(L+5)/2+2*m+1,Q=1e-60;do{I=1+.1*(Q+=Q),Z=1+.2*Q}while(I<=1||Z<=1);for(d=1;d<=i;d+=1)y[d]=n[d];for(d=i+1;d<=x;d+=1)y[d]=0;for(d=1;d<=m;d+=1)h[d]=0;if(b=[],0===g[1]){if(function dpofa(r,n,e,i){var o,u,c,a,f,m;for(u=1;u<=e;u+=1){if(i[1]=u,m=0,(c=u-1)<1){if((m=r[u][u]-m)<=0)break;r[u][u]=Math.sqrt(m)}else{for(a=1;a<=c;a+=1){for(f=r[a][u],o=1;o<a;o+=1)f-=r[o][u]*r[o][a];f/=r[a][a],r[a][u]=f,m+=f*f}if((m=r[u][u]-m)<=0)break;r[u][u]=Math.sqrt(m)}i[1]=0}}(r,0,i,b),0!==b[1])return void(g[1]=2);!function dposl(r,n,e,i){var o,u,c,a;for(u=1;u<=e;u+=1){for(a=0,o=1;o<u;o+=1)a+=r[o][u]*i[o];i[u]=(i[u]-a)/r[u][u]}for(c=1;c<=e;c+=1)for(i[u=e+1-c]=i[u]/r[u][u],a=-i[u],o=1;o<u;o+=1)i[o]=i[o]+a*r[o][u]}(r,0,i,n),function dpori(r,n,e){var i,o,u,c,a;for(u=1;u<=e;u+=1){for(r[u][u]=1/r[u][u],a=-r[u][u],i=1;i<u;i+=1)r[i][u]=a*r[i][u];if(e<(c=u+1))break;for(o=c;o<=e;o+=1)for(a=r[u][o],r[u][o]=0,i=1;i<=u;i+=1)r[i][o]=r[i][o]+a*r[i][u]}}(r,0,i)}else{for(v=1;v<=i;v+=1)for(o[v]=0,d=1;d<=v;d+=1)o[v]=o[v]+r[d][v]*n[d];for(v=1;v<=i;v+=1)for(n[v]=0,d=v;d<=i;d+=1)n[v]=n[v]+r[v][d]*o[d]}for(u[1]=0,v=1;v<=i;v+=1)for(o[v]=n[v],u[1]=u[1]+y[v]*o[v],y[v]=0,d=v+1;d<=i;d+=1)r[d][v]=0;for(u[1]=-u[1]/2,g[1]=0,N=(_=(V=(q=(S=(j=i)+i)+L)+L+1)+L*(L+1)/2)+m,d=1;d<=m;d+=1){for(U=0,v=1;v<=i;v+=1)U+=c[v][d]*c[v][d];y[N+d]=Math.sqrt(U)}function fn_goto_50(){for(l[1]=l[1]+1,x=_,d=1;d<=m;d+=1){for(x+=1,U=-a[d],v=1;v<=i;v+=1)U+=c[v][d]*o[v];if(Math.abs(U)<Q&&(U=0),d>s)y[x]=U;else if(y[x]=-Math.abs(U),U>0){for(v=1;v<=i;v+=1)c[v][d]=-c[v][d];a[d]=-a[d]}}for(d=1;d<=p;d+=1)y[_+h[d]]=0;for(P=0,F=0,d=1;d<=m;d+=1)y[_+d]<F*y[N+d]&&(P=d,F=y[_+d]/y[N+d]);return 0===P?999:0}function fn_goto_55(){for(d=1;d<=i;d+=1){for(U=0,v=1;v<=i;v+=1)U+=r[v][d]*c[v][P];y[d]=U}for(w=j,d=1;d<=i;d+=1)y[w+d]=0;for(v=p+1;v<=i;v+=1)for(d=1;d<=i;d+=1)y[w+d]=y[w+d]+r[d][v]*y[v];for(Y=!0,d=p;d>=1;d-=1){for(U=y[d],w=(x=V+d*(d+3)/2)-d,v=d+1;v<=p;v+=1)U-=y[x]*y[S+v],x+=v;if(U/=y[w],y[S+d]=U,h[d]<s)break;if(U<0)break;Y=!1,M=d}if(!Y)for(D=y[q+M]/y[S+M],d=1;d<=p&&!(h[d]<s)&&!(y[S+d]<0);d+=1)(F=y[q+d]/y[S+d])<D&&(D=F,M=d);for(U=0,d=j+1;d<=j+i;d+=1)U+=y[d]*y[d];if(Math.abs(U)<=Q){if(Y)return g[1]=1,999;for(d=1;d<=p;d+=1)y[q+d]=y[q+d]-D*y[S+d];return y[q+p+1]=y[q+p+1]+D,700}for(U=0,d=1;d<=i;d+=1)U+=y[j+d]*c[d][P];for(R=-y[_+P]/U,z=!0,Y||D<R&&(R=D,z=!1),d=1;d<=i;d+=1)o[d]=o[d]+R*y[j+d],Math.abs(o[d])<Q&&(o[d]=0);for(u[1]=u[1]+R*U*(R/2+y[q+p+1]),d=1;d<=p;d+=1)y[q+d]=y[q+d]-R*y[S+d];if(y[q+p+1]=y[q+p+1]+R,!z){for(U=-a[P],v=1;v<=i;v+=1)U+=o[v]*c[v][P];if(P>s)y[_+P]=U;else if(y[_+P]=-Math.abs(U),U>0){for(v=1;v<=i;v+=1)c[v][P]=-c[v][P];a[P]=-a[P]}return 700}for(h[p+=1]=P,x=V+(p-1)*p/2+1,d=1;d<=p-1;d+=1)y[x]=y[d],x+=1;if(p===i)y[x]=y[i];else{for(d=i;d>=p+1&&0!==y[d]&&(O=Math.max(Math.abs(y[d-1]),Math.abs(y[d])),X=Math.min(Math.abs(y[d-1]),Math.abs(y[d])),F=y[d-1]>=0?Math.abs(O*Math.sqrt(1+X*X/(O*O))):-Math.abs(O*Math.sqrt(1+X*X/(O*O))),O=y[d-1]/F,X=y[d]/F,1!==O);d-=1)if(0===O)for(y[d-1]=X*F,v=1;v<=i;v+=1)F=r[v][d-1],r[v][d-1]=r[v][d],r[v][d]=F;else for(y[d-1]=F,E=X/(1+O),v=1;v<=i;v+=1)F=O*r[v][d-1]+X*r[v][d],r[v][d]=E*(r[v][d-1]+F)-r[v][d],r[v][d-1]=F;y[x]=y[p]}return 0}function fn_goto_797(){if(0===y[w=(x=V+M*(M+1)/2+1)+M])return 798;if(O=Math.max(Math.abs(y[w-1]),Math.abs(y[w])),X=Math.min(Math.abs(y[w-1]),Math.abs(y[w])),F=y[w-1]>=0?Math.abs(O*Math.sqrt(1+X*X/(O*O))):-Math.abs(O*Math.sqrt(1+X*X/(O*O))),O=y[w-1]/F,X=y[w]/F,1===O)return 798;if(0===O){for(d=M+1;d<=p;d+=1)F=y[w-1],y[w-1]=y[w],y[w]=F,w+=d;for(d=1;d<=i;d+=1)F=r[d][M],r[d][M]=r[d][M+1],r[d][M+1]=F}else{for(E=X/(1+O),d=M+1;d<=p;d+=1)F=O*y[w-1]+X*y[w],y[w]=E*(y[w-1]+F)-y[w],y[w-1]=F,w+=d;for(d=1;d<=i;d+=1)F=O*r[d][M]+X*r[d][M+1],r[d][M+1]=E*(r[d][M]+F)-r[d][M+1],r[d][M]=F}return 0}function fn_goto_798(){for(w=x-M,d=1;d<=M;d+=1)y[w]=y[x],x+=1,w+=1;return y[q+M]=y[q+M+1],h[M]=h[M+1],(M+=1)<p?797:0}function fn_goto_799(){return y[q+p]=y[q+p+1],y[q+p+1]=0,h[p]=0,p-=1,l[2]=l[2]+1,0}for(p=0,l[1]=0,l[2]=0,H=0;;){if(999===(H=fn_goto_50()))return;for(;0!==(H=fn_goto_55());){if(999===H)return;if(700===H)if(M===p)fn_goto_799();else{for(;fn_goto_797(),797===(H=fn_goto_798()););fn_goto_799()}}}}numeric.solveQP=function solveQP(r,n,e,i,o,u){r=base0to1(r),n=base0to1(n),e=base0to1(e);var c,a,f,m,s,h=[],p=[],l=[],y=[],g=[];if(o=o||0,u=u?base0to1(u):[void 0,0],i=i?base0to1(i):[],a=r.length-1,f=e[1].length-1,!i)for(c=1;c<=f;c+=1)i[c]=0;for(c=1;c<=f;c+=1)p[c]=0;for(0,m=Math.min(a,f),c=1;c<=a;c+=1)l[c]=0;for(h[1]=0,c=1;c<=2*a+m*(m+5)/2+2*f+1;c+=1)y[c]=0;for(c=1;c<=2;c+=1)g[c]=0;return qpgen2(r,n,0,a,l,h,e,i,0,f,o,p,0,g,y,u),s="",1===u[1]&&(s="constraints are inconsistent, no solution!"),2===u[1]&&(s="matrix D in quadratic function is not positive definite!"),{solution:base1to0(l),value:base1to0(h),unconstrained_solution:base1to0(n),iterations:base1to0(g),iact:base1to0(p),message:s}}}(),numeric.svd=function svd(r){var n,e=numeric.epsilon,i=1e-64/e,o=0,u=0,c=0,a=0,f=0,m=numeric.clone(r),s=m.length,h=m[0].length;if(s<h)throw"Need more rows than columns";var p=new Array(h),l=new Array(h);for(u=0;u<h;u++)p[u]=l[u]=0;var y=numeric.rep([h,h],0);function pythag(r,n){return(r=Math.abs(r))>(n=Math.abs(n))?r*Math.sqrt(1+n*n/r/r):0==n?r:n*Math.sqrt(1+r*r/n/n)}var g=0,d=0,v=0,x=0,w=0,b=0,M=0;for(u=0;u<h;u++){for(p[u]=d,M=0,f=u+1,c=u;c<s;c++)M+=m[c][u]*m[c][u];if(M<=i)d=0;else for(g=m[u][u],d=Math.sqrt(M),g>=0&&(d=-d),v=g*d-M,m[u][u]=g-d,c=f;c<h;c++){for(M=0,a=u;a<s;a++)M+=m[a][u]*m[a][c];for(g=M/v,a=u;a<s;a++)m[a][c]+=g*m[a][u]}for(l[u]=d,M=0,c=f;c<h;c++)M+=m[u][c]*m[u][c];if(M<=i)d=0;else{for(g=m[u][u+1],d=Math.sqrt(M),g>=0&&(d=-d),v=g*d-M,m[u][u+1]=g-d,c=f;c<h;c++)p[c]=m[u][c]/v;for(c=f;c<s;c++){for(M=0,a=f;a<h;a++)M+=m[c][a]*m[u][a];for(a=f;a<h;a++)m[c][a]+=M*p[a]}}(w=Math.abs(l[u])+Math.abs(p[u]))>x&&(x=w)}for(u=h-1;-1!=u;u+=-1){if(0!=d){for(v=d*m[u][u+1],c=f;c<h;c++)y[c][u]=m[u][c]/v;for(c=f;c<h;c++){for(M=0,a=f;a<h;a++)M+=m[u][a]*y[a][c];for(a=f;a<h;a++)y[a][c]+=M*y[a][u]}}for(c=f;c<h;c++)y[u][c]=0,y[c][u]=0;y[u][u]=1,d=p[u],f=u}for(u=h-1;-1!=u;u+=-1){for(f=u+1,d=l[u],c=f;c<h;c++)m[u][c]=0;if(0!=d){for(v=m[u][u]*d,c=f;c<h;c++){for(M=0,a=f;a<s;a++)M+=m[a][u]*m[a][c];for(g=M/v,a=u;a<s;a++)m[a][c]+=g*m[a][u]}for(c=u;c<s;c++)m[c][u]=m[c][u]/d}else for(c=u;c<s;c++)m[c][u]=0;m[u][u]+=1}for(e*=x,a=h-1;-1!=a;a+=-1)for(var j=0;j<50;j++){var S=!1;for(f=a;-1!=f;f+=-1){if(Math.abs(p[f])<=e){S=!0;break}if(Math.abs(l[f-1])<=e)break}if(!S){o=0,M=1;var V=f-1;for(u=f;u<a+1&&(g=M*p[u],p[u]=o*p[u],!(Math.abs(g)<=e));u++)for(v=pythag(g,d=l[u]),l[u]=v,o=d/v,M=-g/v,c=0;c<s;c++)w=m[c][V],b=m[c][u],m[c][V]=w*o+b*M,m[c][u]=-w*M+b*o}if(b=l[a],f==a){if(b<0)for(l[a]=-b,c=0;c<h;c++)y[c][a]=-y[c][a];break}if(j>=49)throw"Error: no convergence.";for(x=l[f],d=pythag(g=(((w=l[a-1])-b)*(w+b)+((d=p[a-1])-(v=p[a]))*(d+v))/(2*v*w),1),g=g<0?((x-b)*(x+b)+v*(w/(g-d)-v))/x:((x-b)*(x+b)+v*(w/(g+d)-v))/x,o=1,M=1,u=f+1;u<a+1;u++){for(d=p[u],w=l[u],v=M*d,d*=o,b=pythag(g,v),p[u-1]=b,g=x*(o=g/b)+d*(M=v/b),d=-x*M+d*o,v=w*M,w*=o,c=0;c<h;c++)x=y[c][u-1],b=y[c][u],y[c][u-1]=x*o+b*M,y[c][u]=-x*M+b*o;for(b=pythag(g,v),l[u-1]=b,g=(o=g/b)*d+(M=v/b)*w,x=-M*d+o*w,c=0;c<s;c++)w=m[c][u-1],b=m[c][u],m[c][u-1]=w*o+b*M,m[c][u]=-w*M+b*o}p[f]=0,p[a]=g,l[a]=x}for(u=0;u<l.length;u++)l[u]<e&&(l[u]=0);for(u=0;u<h;u++)for(c=u-1;c>=0;c--)if(l[c]<l[u]){for(o=l[c],l[c]=l[u],l[u]=o,a=0;a<m.length;a++)n=m[a][u],m[a][u]=m[a][c],m[a][c]=n;for(a=0;a<y.length;a++)n=y[a][u],y[a][u]=y[a][c],y[a][c]=n;u=c}return{U:m,S:l,V:y}};!function(t,i){"use strict";var e,o,n="";t.addEventListener?e="addEventListener":(e="attachEvent",n="on"),void 0!==i.onmousewheel&&(o="mousewheel");try{WheelEvent("wheel"),o="wheel"}catch(t){}function _addWheelListener(i,s,r,a){i[e](n+s,"wheel"===o?r:function(i){i||(i=t.event);var e={originalEvent:i,target:i.target||i.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"===i.type?0:1,deltaX:0,delatZ:0,preventDefault:function(){i.preventDefault?i.preventDefault():i.returnValue=!1}};return"mousewheel"===o?(e.deltaY=-1/40*i.wheelDelta,i.wheelDeltaX&&(e.deltaX=-1/40*i.wheelDeltaX),e.pageX=i.pageX,e.pageY=i.pageY,e.clientX=i.clientX,e.clientY=i.clientY):e.deltaY=i.detail,r(e)},a||!1)}o||(o="DOMMouseScroll"),t.addWheelListener=function(t,i,e){_addWheelListener(t,o,i,e),"DOMMouseScroll"===o&&_addWheelListener(t,"MozMousePixelScroll",i,e)}}(window,document);var matplot=function(){"use strict";var t={};function getterSetterMode(t,i,e){return function(o){return 0===arguments.length?"auto"===this[e]?t.call(this):this[i]:(this[i]=o,this[e]="manual",this)}}function getterSetterVal(t,i){return function(e){if(0===arguments.length)return this[t];if(-1===i.indexOf(e))throw"Error: value of property "+t+" should be one of "+i.join(", ")+" but got "+e+".";return this[t]=e,this}}function installGetterSetterMode(i,e){void 0===e&&(e=function(){this["sensible"+i].call(this)}),t.Axis.prototype[i]=getterSetterMode(e,"_"+i,"_"+i+"Mode"),t.Axis.prototype[i+"Mode"]=getterSetterVal("_"+i+"Mode",["auto","manual"])}return t.DEFAULT_FONT='"Liberation Sans"',t.DEFAULT_FONT="Arial",t.DEFAULT_FONT_SIZE=10,t.colormaps={jet:[[0,0,.5],[0,0,.563492063492063],[0,0,.626984126984127],[0,0,.69047619047619],[0,0,.753968253968254],[0,0,.817460317460317],[0,0,.880952380952381],[0,0,.944444444444444],[0,.007936507936508,1],[0,.071428571428571,1],[0,.134920634920635,1],[0,.198412698412698,1],[0,.261904761904762,1],[0,.325396825396825,1],[0,.388888888888889,1],[0,.452380952380952,1],[0,.515873015873016,1],[0,.579365079365079,1],[0,.642857142857143,1],[0,.706349206349206,1],[0,.76984126984127,1],[0,.833333333333333,1],[0,.896825396825397,1],[0,.96031746031746,1],[.023809523809524,1,.976190476190476],[.087301587301587,1,.912698412698413],[.150793650793651,1,.849206349206349],[.214285714285714,1,.785714285714286],[.277777777777778,1,.722222222222222],[.341269841269841,1,.658730158730159],[.404761904761905,1,.595238095238095],[.468253968253968,1,.531746031746032],[.531746031746032,1,.468253968253968],[.595238095238095,1,.404761904761905],[.658730158730159,1,.341269841269841],[.722222222222222,1,.277777777777778],[.785714285714286,1,.214285714285714],[.849206349206349,1,.150793650793651],[.912698412698413,1,.087301587301587],[.976190476190476,1,.023809523809524],[1,.96031746031746,0],[1,.896825396825397,0],[1,.833333333333333,0],[1,.76984126984127,0],[1,.706349206349207,0],[1,.642857142857143,0],[1,.57936507936508,0],[1,.515873015873016,0],[1,.452380952380953,0],[1,.388888888888889,0],[1,.325396825396826,0],[1,.261904761904762,0],[1,.198412698412699,0],[1,.134920634920635,0],[1,.071428571428572,0],[1,.007936507936508,0],[.944444444444445,0,0],[.880952380952381,0,0],[.817460317460318,0,0],[.753968253968254,0,0],[.690476190476191,0,0],[.626984126984127,0,0],[.563492063492064,0,0],[.5,0,0]]},t.trans={mercator:[function(t){return[t[0]*Math.PI/180,Math.log(Math.tan(Math.PI/4+t[1]/2*Math.PI/180)),t[2],t[3]]},function(t){return[180*t[0]/Math.PI,360*Math.atan(Math.exp(t[1]))/Math.PI-90,t[2],t[3]]}]},t.supportsSVG=function(){return document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Shape","1.1")},t.clone=function(i){var e,o,n,s;if(null===i||"object"!=typeof i)return i;if(i instanceof Date)return(e=new Date).setTime(i.getTime()),e;if(i instanceof Array){for(e=[],o=0,s=i.length;o<s;o++)e[o]=t.clone(i[o]);return e}if(i instanceof Object){for(n in e={},i)i.hasOwnProperty(n)&&(e[n]=t.clone(i[n]));return e}throw new Error("Unable to copy obj! Its type isn't supported.")},t.peaks=function(t){var i,e,o,n=[],s=[],r=[];for(t=void 0===t?50:t,o=function(t,i){return 3*(1-t)*(1-t)*Math.exp(-t*t-(i+1)*(i+1))-10*(t/5-t*t*t-Math.pow(i,5))*Math.exp(-t*t-i*i)-1/3*Math.exp(-(t+1)*(t+1)-i*i)},i=0;i<t-1;i++)for(n[i]=[],s[i]=[],r[i]=[],e=0;e<t-1;e++)n[i][e]=6.25*i/t-3,s[i][e]=6.25*e/t-3,r[i][e]=o(n[i][e],s[i][e]);return{x:n,y:s,z:r}},t.range=function(t,i,e){var o,n=[];for(e=e||1,o=t;o<=i;o+=e)n.push(o);return n},t.ticks=function ticks(t,i,e){var o,n,s,r,a,h,c,l;for(e<2&&(e=2),n=(r=(r=(n=(i-t)/e)/(s=Math.pow(10,Math.floor(Math.log(n)/Math.LN10))))<=1.5?1:r<2.5?2:r<=4?3:r<=7?5:10)*s,a=Math.ceil(t/n)*n,o=Math.round(Math.floor(i/n)-Math.ceil(t/n)+1),c=[],h=0;h<o;h++)c[h]=a+h*n,l=n,c[h]=Math.round(c[h]/l)*l,Math.abs(c[h])<1e-14&&(c[h]=0);return c},t.remove_spurious_decimals=function(t){var i,e,o;return"number"==typeof t&&(t=t.toString()),i=new RegExp("(\\.[0-9]*[1-9]+)0{4,}.*$"),o=t.replace(i,"$1"),e=new RegExp("(\\.)0{4,}.*$"),o.replace(e,"$1")},t.mk=function mk(t,i,e,o){var n,s,r,a,h,c,l,p;for(r in e=e||{},o=o||[],""===t?(n=document.createElement(i),p=function(t,i,e){t.setAttribute(i,e)}):(n=document.createElementNS(t,i),p=function(t,i,e){t.setAttributeNS(null,i,e)}),e)if(e.hasOwnProperty(r)&&void 0!==e[r])if("function"==typeof e[r])n[r]=e[r];else if("style"===r&&"object"==typeof e[r]){for(l in h="",c=e[r])c.hasOwnProperty(l)&&void 0!==c[l]&&(h+=l+": "+c[l]+";");p(n,r,h)}else p(n,r,e[r]);for(a in o)o.hasOwnProperty(a)&&(s="string"==typeof o[a]?document.createTextNode(o[a]):o[a],n.appendChild(s));return n},t.html=function mk(i,e,o){return t.mk("",i,e,o)},t.dasharray=function(t){return"-"===t?[]:"-."===t?[15,5,1,5]:":"===t?[1,3]:"--"===t?[15,5]:void 0},t.SVGCanvas=function SVGCanvas(t,i,e){this.xmlns="http://www.w3.org/2000/svg",this.width=i,this.height=e,this.layers=[],this.container=t,this.container.appendChild(this.svg=this.mk("svg",{version:"1.1",baseProfile:"basic",width:i,height:e})),this.elem=this.svg,this.clear(),this.idconter=0},t.SVGCanvas.prototype.id=function(){return"matplot_svg_canvas_"+this.idconter++},t.SVGCanvas.prototype.push=function(t){this._currentLayer.groups.push(t)},t.SVGCanvas.prototype.pop=function(){return this._currentLayer.groups.pop()},t.SVGCanvas.prototype.parent=function(){var t=this._currentLayer.groups;return t[t.length-1]},t.SVGCanvas.prototype.mk=function mk(i,e,o){return t.mk(this.xmlns,i,e,o)},t.SVGCanvas.prototype.newLayer=function(){var t={groups:[this.mk("g")]};return this.elem.appendChild(t.groups[0]),this.layers.push(t),this._currentLayer=t,t},t.SVGCanvas.prototype.removeLayer=function(t){this.elem.removeChild(t.groups[0]),this.layers=this.layers.filter((function(i){return i.groups!==t.groups}))},t.SVGCanvas.prototype.currentLayer=function(t){return 0===arguments.length||(this._currentLayer=t),this._currentLayer},t.SVGCanvas.prototype.clear=function(){for(var t=this.svg.firstChild;t;)this.svg.removeChild(t),t=this.svg.firstChild;this.newLayer()},t.SVGCanvas.prototype.clipRect=function(t,i,e,o,n){var s,r=this.id();return this.parent().appendChild(this.mk("defs",{},[this.mk("clipPath",{id:r},[this.mk("rect",{x:t,y:i,width:e,height:o,style:n},[])])])),this.push(s=this._group({"clip-path":"url(#"+r+")"})),s},t.SVGCanvas.prototype.exitClipRect=function(){this.pop()},t.SVGCanvas.prototype._group=function(t){var i;return t=t||{},this.parent().appendChild(i=this.mk("g",{"clip-path":t["clip-path"]})),i},t.SVGCanvas.prototype.rect=function(t,i,e,o,n){var s;return n=n||{},this.parent().appendChild(s=this.mk("rect",{x:t,y:i,width:e,height:o,onclick:n.onclick,style:{fill:n.fill||"none","fill-opacity":n["fill-opacity"],"pointer-events":n["pointer-events"],stroke:n.stroke||"black"}})),s},t.SVGCanvas.prototype.circle=function(t,i,e,o){var n;return o=o||{},this.parent().appendChild(n=this.mk("circle",{cx:t,cy:i,r:e,onclick:o.onclick,style:{fill:o.fill||"none",stroke:o.stroke||"black","pointer-events":o["pointer-events"]}})),n},t.SVGCanvas.prototype.polygon=function(t,i,e){var o,n,s="";for(n=0;n<t.length;n++)s+=t[n]+","+i[n]+" ";return this.parent().appendChild(o=this.mk("polygon",{points:s,onclick:e.onclick,style:{fill:e.fill,stroke:e.stroke}})),o},t.SVGCanvas.prototype.textBBox=function(i,e){var o,n,s,r;return n=(e=e||{}).FontSize||t.DEFAULT_FONT_SIZE,s=e.FontFamily||t.DEFAULT_FONT,o=this.mk("text",{x:-1e4,y:0,style:{"font-family":s,"font-size":n}},[i]),this.parent().appendChild(o),r=o.getBBox(),this.parent().removeChild(o),{width:r.width,height:r.height}},t.SVGCanvas.prototype.text=function(i,e,o,n){var s,r,a,h,c,l,p,u,d,f=0;return r=(n=n||{}).offseti||0,a=n.offsetj||0,h=n.FontSize||t.DEFAULT_FONT_SIZE,c=n.FontFamily||t.DEFAULT_FONT,l=n.color||"black",p=n.HorizontalAlignment||"left",u=n.VerticalAlignment||"baseline","left"===p?d="start":"center"===p?d="middle":"right"===p?d="end":console.error(p),"top"===u?f=h:"middle"===u?f=h/2-1.5:"baseline"===u&&(f=0),this.parent().appendChild(s=this.mk("text",{x:i+r,y:e+a,style:{"font-family":c,"font-size":h},"text-anchor":d,dy:f,onclick:n.onclick,fill:l},[o])),s},t.SVGCanvas.prototype.line=function(i,e,o){var n,s,r,a,h="";if("none"===(r=o.linespec||"-"))return null;for(a="-"===r?"none":t.dasharray(r).map((function(t){return t.toString()})).join(),s=0;s<i.length;s++)h+=i[s]+","+e[s]+" ";return this.parent().appendChild(n=this.mk("polyline",{points:h,onclick:o.onclick,style:{fill:"none",stroke:o.color||"black","stroke-width":o.linewidth||1,"stroke-dasharray":a}})),n},t.SVGCanvas.prototype.serialize=function(t){var i;null===(i=(new XMLSerializer).serializeToString(this.svg)).match(' xmlns="')&&(i=i.replace("<svg ",'<svg xmlns="'+this.xmlns+'" ')),t({data:new Blob(['<?xml version="1.0" encoding="UTF-8"?>',i],{type:"application/octet-stream"}),download:"figure.svg"})},t.RasterCanvas=function RasterCanvas(i,e,o){this.container=i,this.width=e,this.height=o,this.layers=[],this.container.appendChild(this.canvasLayers=t.html("div",{style:{width:e+"px",height:o+"px"}})),this.elem=this.canvasLayers,this.clear();var n=this;this.container.addEventListener("mousedown",(function(t){var i={};i.x=t.pageX-n.container.offsetLeft,i.y=t.pageY-n.container.offsetTop,console.log("click pe",i),n.processEvent(i)}))},t.RasterCanvas.prototype.processEvent=function(t){var i,e,o,n;for(e=this.layers.length-1;e>=0;e--)for(i=(n=this.layers[e].interactive).length-1;i>=0;i--)(o=n[i])[0]<=t.x&&t.x<=o[1]&&o[2]<=t.y&&t.y<=o[3]&&(t.target=o,o[4](t))},t.RasterCanvas.prototype.newLayer=function(){var i,e;return e=t.html("canvas",{width:this.width,height:this.height,style:{position:"absolute",top:"0px",left:"0px"}}),this.canvasLayers.appendChild(e),i={canvas:e,context:e.getContext("2d"),interactive:[]},this.layers.push(i),this.context=i.context,this.interactive=i.interactive,i},t.RasterCanvas.prototype.removeLayer=function(t){this.context===t.context&&console.error("cannot remove current layer"),this.canvasLayers.removeChild(t.canvas),this.layers=this.layers.filter((function(i){return i.context!==t.context}))},t.RasterCanvas.prototype.currentLayer=function(t){return 0!==arguments.length&&(this.context=t.context,this.interactive=t.interactive),{context:this.context,interactive:this.interactive}},t.RasterCanvas.prototype.clear=function(){for(var t=this.canvasLayers.firstChild;t;)this.canvasLayers.removeChild(t),t=this.canvasLayers.firstChild;this.newLayer()},t.RasterCanvas.prototype.clipRect=function(t,i,e,o,n){this.context.save(),this.context.rect(t,i,e,o),this.context.clip()},t.RasterCanvas.prototype.exitClipRect=function(){this.context.restore()},t.RasterCanvas.prototype.rect=function(t,i,e,o,n){var s;s=(n=n||{}).fill||"none",this.context.save(),"none"!==s&&(this.context.fillStyle=s,this.context.fillRect(t,i,e,o)),this.context.beginPath(),this.context.rect(t,i,e,o),this.context.lineWidth=1,this.context.strokeStyle=n.stroke||"black",this.context.stroke(),this.context.restore(),n.onclick&&this.interactive.push([t,t+e,i,i+o,n.onclick])},t.RasterCanvas.prototype.circle=function(t,i,e,o){var n;o=o||{},this.context.beginPath(),this.context.arc(t,i,e,0,2*Math.PI,!1),"none"!==(n=o.fill||"none")&&(this.context.fillStyle=n,this.context.fill()),this.context.lineWidth=1,this.context.strokeStyle=o.stroke||"black",this.context.stroke(),o.onclick&&this.interactive.push([t-e/2,t+e/2,i-e/2,i+e/2,o.onclick])},t.RasterCanvas.prototype.polygon=function(t,i,e){var o,n;for(this.context.save(),this.context.beginPath(),this.context.moveTo(t[0],i[0]),o=1;o<t.length;o++)this.context.lineTo(t[o],i[o]);n=e.fill||"none",this.context.lineWidth=0,"none"!==n&&(this.context.fillStyle=e.fill,this.context.fill()),this.context.strokeStyle=e.stroke||"black",this.context.stroke(),this.context.restore()},t.RasterCanvas.prototype.textBBox=function(i,e){var o,n,s;return o=(e=e||{}).FontSize||t.DEFAULT_FONT_SIZE,n=e.FontFamily||t.DEFAULT_FONT,this.context.save(),this.context.font=o+"px "+n,s=this.context.measureText(i),this.context.restore(),{width:s.width,height:o}},t.RasterCanvas.prototype.text=function(i,e,o,n){var s,r,a,h,c,l,p=0;s=(n=n||{}).offseti||0,r=n.offsetj||0,a=n.FontSize||t.DEFAULT_FONT_SIZE,h=n.FontFamily||t.DEFAULT_FONT,n.color,c=n.HorizontalAlignment||"left",l=n.VerticalAlignment||"baseline",this.context.save(),this.context.textAlign=c,"top"===l?p=a:"middle"===l?p=a/2-1.5:"baseline"===l&&(p=0),this.context.font=a+"px "+h,this.context.fillText(o,i+s,e+r+p),this.context.restore()},t.RasterCanvas.prototype.line=function(i,e,o){var n,s,r;if(s=o.linespec||"-",this.context.save(),this.context.beginPath(),this.context.setLineDash||(this.context.setLineDash=function(){}),"none"!==s){for(r=t.dasharray(s),this.context.setLineDash(r),this.context.moveTo(i[0],e[0]),n=1;n<i.length;n++)this.context.lineTo(i[n],e[n]);this.context.lineWidth=o.linewidth||1,this.context.strokeStyle=o.color||"black",this.context.stroke(),this.context.restore()}},t.RasterCanvas.prototype.serialize=function(i){var e,o,n,s;for(o=(e=t.html("canvas",{width:this.width,height:this.height})).getContext("2d"),s=0;s<this.layers.length;s++)o.drawImage(this.layers[s].context.canvas,0,0);e.toBlob?e.toBlob((function(t){i({data:t,download:"figure.png"})}),"image/png"):(n=e.toDataURL("image/png"),i({dataURL:n,download:"figure.png"}))},t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.subsref=function subsref(t,i){var e,o,n,s=i[0];if(":"===s&&(s=[0,1,t.length-1]),s instanceof Array){for(2===s.length&&(s=[s[0],1,s[1]]),n=i.slice(0),o=[],e=s[0];e<=s[2];e+=s[1])n[0]=e,o.push(subsref(t,n));return o}return o=t[s],1===i.length?o:subsref(o,i.slice(1))},t.arrayMap=function arrayMap(i,e){var o,n;for(o=0;o<i.length;o++)t.isArray(i[o])?arrayMap(i[o],e):void 0!==(n=e(i[o]))&&(i[o]=n)},t.flatten=function flatten(i){var e=[];return t.arrayMap(i,(function(t){e.push(t)})),e},t.dataRange=function(i){var e=1/0,o=-1/0;return t.arrayMap(i,(function(t){isNaN(t)||(e=Math.min(e,t),o=Math.max(o,t))})),e===1/0?[NaN,NaN]:[e,o]},t.prettyRange=function(t){var i=t[0],e=t[1];return(isNaN(i)||isNaN(e))&&(i=-1,e=1),i===e&&(i-=1,e+=1),[i,e]},t.Surface=function Surface(t,i,e,o,n){this.x=t,this.y=i,this.z=e,this.c=o,this.style=n||{}},t.Surface.prototype.lim=function(i){var e=this[i];return t.dataRange(e)},t.Surface.prototype.draw=function(t){var i,e;for(i=0;i<this.x.length-1;i++)for(e=0;e<this.x[0].length-1;e++)isNaN(this.c[i][e])||t.polygon([this.x[i][e],this.x[i+1][e],this.x[i+1][e+1],this.x[i][e+1]],[this.y[i][e],this.y[i+1][e],this.y[i+1][e+1],this.y[i][e+1]],[this.z[i][e],this.z[i+1][e],this.z[i+1][e+1],this.z[i][e+1]],this.c[i][e])},t.Patch=function Patch(t,i,e,o){this.x=t,this.y=i,this.z=e,this.c=[],this.style=o||{}},t.Patch.prototype.lim=function(i){var e=this[i];return t.dataRange(e)},t.Patch.prototype.draw=function(t){t.polygon(this.x,this.y,this.z,0,this.style.color||"black")},t.Line=function Line(t,i,e,o){this.x=t,this.y=i,this.z=e,this.style=o||{}},t.Line.prototype.lim=function(i){var e=this[i];return"c"===i?[NaN,NaN]:t.dataRange(e)},t.Line.prototype.draw=function(t){t.drawLine(this.x,this.y,this.z,this.style)},t.Quiver=function Quiver(t,i,e,o,n,s,r,a){this.x=t,this.y=i,this.z=e,this.u=o,this.v=n,this.w=s,this.c=r,this.style=a||{}},t.Quiver.prototype.lim=function(i){var e,o=this[i];return"c"===i?t.isArray(o)?t.dataRange(o):[NaN,NaN]:(e=void 0===this.style.scale?1:this.style.scale,"x"===i&&(o=[o,numeric.add(o,t.prod(e,this.u))]),"y"===i&&(o=[o,numeric.add(o,t.prod(e,this.v))]),"z"===i&&(o=[o,numeric.add(o,t.prod(e,this.w))]),t.dataRange(o))},t.Quiver.prototype.draw=function(i){var e,o,n,s,r,a,h,c,l,p,u,d,f,m,y;for(y in r=void 0===this.style.scale?1:this.style.scale,a=void 0===this.style.relLen?.7:this.style.relLen,h=void 0===this.style.relOpen?.2:this.style.relOpen,m={},this.style)this.style.hasOwnProperty(y)&&(m[y]=this.style[y]);for(e=0;e<this.x.length;e++)c=this.x[e],l=this.y[e],p=this.z[e],u=r*this.u[e],d=r*this.v[e],f=r*this.w[e],void 0===this.style.color&&t.isArray(this.c)&&(m.color=i.cmap.get(this.c[e])),o=[c,c+u],n=[l,l+d],s=[p,p+f],i.drawLine(o,n,s,m),o=[c+a*u-h*d,o[1],c+a*u+h*d],n=[l+a*d+h*u,n[1],l+a*d-h*u],s=[p+a*f,s[1],p+a*f],i.drawLine(o,n,s,m)},t.Scatter=function Scatter(t,i,e,o,n,s){this.x=t,this.y=i,this.z=e,this.size=o,this.c=n,this.style=s||{}},t.Scatter.prototype.lim=function(i){var e=this[i];return t.dataRange(e)},t.Scatter.prototype.draw=function(i){var e,o,n;for(n in void 0===this.style.scale?1:this.style.scale,void 0===this.style.relLen?.7:this.style.relLen,void 0===this.style.relOpen?.2:this.style.relOpen,o={},this.style)this.style.hasOwnProperty(n)&&(o[n]=this.style[n]);for(o.marker=o.marker||"o",e=0;e<this.x.length;e++)this.x[e],this.y[e],this.z[e],void 0===this.style.color&&t.isArray(this.c)&&(o.color=i.cmap.get(this.c[e]),o.MarkerFaceColor=o.color),o.markerSize=this.size[e],i.drawLine([this.x[e]],[this.y[e]],[this.z[e]],o)},t.ColorMap=function ColorMap(i,e){this.cLim=i,this.type=e||"jet",this.cm=t.colormaps[this.type]},t.ColorMap.prototype.get=function(t){var i,e,o=[];return i=(t-this.cLim[0])/(this.cLim[1]-this.cLim[0]),o[0]=i,o[1]=1,o[2]=1,e=Math.round(i*this.cm.length),e=Math.max(Math.min(e,this.cm.length-1),0),o=this.cm[e],"rgb("+Math.round(255*o[0])+","+Math.round(255*o[1])+","+Math.round(255*o[2])+")"},t.Axis=function Axis(i,e,o,n,s){this.fig=i,this.x=e,this.y=o,this.w=n,this.h=s,this.cmap=new t.ColorMap([-1,1]),this.FontFamily="Verdana",this.FontSize=15,this.color="black",this.children=[],this._projection="orthographic",this._xLim=[],this._xLimMode="auto",this.xLabel="",this.xGrid="on",this.xDir="normal",this.xScale="linear",this.xMinorGrid="off",this.xMinorTick="off",this.xColor=[0,0,0],this.xTickLen=10,this.xTickMode="auto",this.xTick=[],this.xTickLabelMode="auto",this.xTickLabel=[],this.xAxisLocation="bottom",this._yLim=[],this._yLimMode="manual",this.yLabel="",this.yGrid="on",this.yDir="normal",this.yScale="linear",this.yMinorGrid="off",this.yMinorTick="off",this.yColor=[0,0,0],this.yTickLen=10,this.yTickMode="auto",this.yTick=[],this.yTickLabelMode="auto",this.yTickLabel=[],this.yAxisLocation="left",this._zLim=[],this._zLimMode="auto",this.zLabel="",this.zGrid="on",this.zDir="normal",this.zScale="linear",this.zMinorGrid="off",this.zMinorTick="off",this.zColor=[0,0,0],this.zTickLen=10,this.zTickMode="auto",this.zTick=[],this.zTickLabelMode="auto",this.zTickLabel=[],this._cLim=[],this._cLimMode="auto",this._DataAspectRatioMode="auto",this._DataAspectRatio=[1,1,1],this._CameraPosition=[0,0,10],this._CameraPositionMode="auto",this._CameraTarget=[0,0,0],this._CameraTargetMode="auto",this._CameraUpVector=[0,1,0],this._CameraUpVectorMode="auto",this._CameraViewAngle=10.3396,this._CameraViewAngleMode="auto",this.xLabelFormat=function(i){return t.remove_spurious_decimals(i.toString())},this.yLabelFormat=function(i){return t.remove_spurious_decimals(i.toString())},this.zLabelFormat=function(i){return t.remove_spurious_decimals(i.toString())},this.gridLineStyle=":",this.legendZIndex=1e3,this.annotationNDigits=3,this.annotationFormat=function(t){var i=t.toString(),e=t.toPrecision(this.annotationNDigits);return e.length<i.length?e:i},this.annotatedElements=[],this._annotations=[],this._transform=[function(t){return t},function(t){return t}],this.renderedElements=[]},t.Axis.prototype.projection=getterSetterVal("_projection",["orthographic","perspective"]),t.Axis.prototype.xtick=getterSetterMode((function(){return this.xTick}),"xTick","xTickMode"),t.Axis.prototype.ytick=getterSetterMode((function(){return this.yTick}),"yTick","yTickMode"),t.Axis.prototype.ztick=getterSetterMode((function(){return this.zTick}),"zTick","zTickMode"),t.Axis.prototype.DataAspectRatio=getterSetterMode((function(){return this._DataAspectRatio}),"_DataAspectRatio","_DataAspectRatioMode"),t.Axis.prototype.DataAspectRatioMode=getterSetterVal("_DataAspectRatioMode",["auto","manual"]),installGetterSetterMode("xLim",(function(){return this.lim("x")})),installGetterSetterMode("yLim",(function(){return this.lim("y")})),installGetterSetterMode("zLim",(function(){return this.lim("z")})),installGetterSetterMode("cLim",(function(){return this.lim("c")})),installGetterSetterMode("CameraPosition",(function(){return this._CameraPosition})),installGetterSetterMode("CameraUpVector"),t.prod=function(t){var i;for(i=1;i<arguments.length;i++)t=numeric.dot(t,arguments[i]);return t},t.cross=function(t,i){var e=[];return e[0]=t[1]*i[2]-t[2]*i[1],e[1]=t[2]*i[0]-t[0]*i[2],e[2]=t[0]*i[1]-t[1]*i[0],e},t.perspective=function(t,i,e,o){var n=1/Math.tan(t/2),s=e-o;return[[n/i,0,0,0],[0,n,0,0],[0,0,(o+e)/s,2*o*e/s],[0,0,-1,0]]},t.scale=function(t){return[[t[0],0,0,0],[0,t[1],0,0],[0,0,t[2],0],[0,0,0,1]]},t.translate=function(t){return[[1,0,0,t[0]],[0,1,0,t[1]],[0,0,1,t[2]],[0,0,0,1]]},t.ortho=function(i,e,o,n,s,r){return numeric.dot(t.scale([2/(e-i),2/(n-o),2/(r-s)]),t.translate([-(e+i)/2,-(n+o)/2,-(r+s)/2]))},t.LookAt=function(i,e,o){var n,s,r,a;return n=numeric.sub(e,i),n=numeric.mul(1/numeric.norm2(n),n),s=t.cross(n,o),s=numeric.mul(1/numeric.norm2(s),s),r=t.cross(s,n),a=[[s[0],s[1],s[2],0],[r[0],r[1],r[2],0],[-n[0],-n[1],-n[2],0],[0,0,0,1]],a=numeric.dot(a,t.translate([-i[0],-i[1],-i[2]]))},t.Axis.prototype.zoom=function(t,i,e){var o,n,s,r;function newrange(i,e){var o,n;return t>0?(o=r*(i[1]-i[0]),n=r*(i[0]+i[1])/2+(1-r)*e):(o=(i[1]-i[0])/r,n=((i[0]+i[1])/2-(1-r)*e)/r),[n-o/2,n+o/2]}o=i-this.fig.container.offsetLeft,n=e-this.fig.container.offsetTop,s=this.unproject([o,n]),r=1+Math.abs(t)/20,this.xLim(newrange(this.xLim(),s[0])),this.yLim(newrange(this.yLim(),s[1])),this.fig.draw()},t.Axis.prototype.resetZoom=function(){this.xLimMode("auto"),this.yLimMode("auto"),this.fig.draw(),this.fig.closeContextmenu()},t.Axis.prototype.project=function(t,i){var e,o,n;if(o=(i=i||{}).viewport||this.viewport,n=i.projectionModelView||this.projectionModelView,2===(e=t.slice(0)).length&&(e[2]=0),3===e.length&&(e[3]=1),e=this._transform[0](e),(e=numeric.dot(n,e))[0]=e[0]/e[3],e[1]=e[1]/e[3],e[2]=e[2]/e[3],e[3]=e[3]/e[3],e=numeric.dot(o,e),isNaN(e[0]))throw"Internal error";return e},t.Axis.prototype.unproject=function(t){var i;return i=[t[0],t[1],0,1],i=numeric.dot(this.invViewport,i),i=numeric.dot(this.invProjectionModelView,i),i=this._transform[1](i)},t.Axis.prototype.lim=function(t){var i,e,o=1/0,n=-1/0;if(this.children.length>0)for(i=0;i<this.children.length;i++)e=this.children[i].lim(t),isNaN(e[0])||(o=Math.min(o,e[0])),isNaN(e[1])||(n=Math.max(n,e[1]));else o=n=NaN;return[o,n]},t.Axis.prototype.transform=function(t){this._transform=t},t.Axis.prototype.plot=function(i,e,o,n){var s,r,a;if(r=(a=Array.prototype.slice.call(arguments))[a.length-1],"[object Array]"===Object.prototype.toString.call(r)&&(a.push({}),t.Axis.prototype.plot.apply(this,a)),2===a.length)for(e=a[0],n=a[1],i=[],o=[],s=0;s<e.length;s++)i[s]=s,o[s]=0;else if(3===a.length)for(i=a[0],e=a[1],n=a[2],o=[],s=0;s<i.length;s++)o[s]=0;this.children=[],this.children.push(new t.Line(i,e,o,n))},t.Axis.prototype.pcolor=function(i,e,o){var n,s,r,a,h=[];if(1===arguments.length)for(o=i,i=[],e=[],i=e=[],n=0;n<o.length;n++)for(i[n]=[],e[n]=[],s=0;s<o[0].length;s++)i[n][s]=n,e[n][s]=s;for(n=0;n<o.length;n++)for(h[n]=[],s=0;s<o[0].length;s++)h[n][s]=0;if(!t.isArray(i[0]))for(r=i,a=e,i=[],e=[],n=0;n<o.length;n++)for(i[n]=[],e[n]=[],s=0;s<o[0].length;s++)i[n][s]=r[n],e[n][s]=a[s];this.children.push(new t.Surface(i,e,h,o))},t.Axis.prototype.surf=function(i,e,o){this.children.push(new t.Surface(i,e,o,o))},t.Axis.prototype.patch=function(i,e,o,n){var s;if(3===arguments.length)for(n=o,o=[],s=0;s<i.length;s++)o[s]=0;this.children.push(new t.Patch(i,e,o,n))},t.Axis.prototype.quiver=function(i,e,o,n,s){var r,a,h,c;for(s=s||{},i=t.flatten(i),e=t.flatten(e),o=t.flatten(o),n=t.flatten(n),a=[],r=0;r<i.length;r++)a[r]=0;h=a,"norm"===(c=s.color)&&(c=numeric.sqrt(numeric.add(numeric.pow(o,2),numeric.pow(n,2),numeric.pow(h,2))),s.color=void 0),this.children.push(new t.Quiver(i,e,a,o,n,a,c,s))},t.Axis.prototype.scatter=function(i,e,o,n,s){var r,a,h;if(i=t.flatten(i),e=t.flatten(e),"number"==typeof o)for(h=[],r=0;r<i.length;r++)h[r]=o;else h=t.flatten(o);for(n=t.flatten(n),a=[],r=0;r<i.length;r++)a[r]=0;this.children.push(new t.Scatter(i,e,a,h,n,s))},t.Axis.prototype.scatter3=function(i,e,o,n,s,r){var a,h;if(i=t.flatten(i),e=t.flatten(e),o=t.flatten(o),s=t.flatten(s),"number"==typeof n)for(h=[],a=0;a<i.length;a++)h[a]=n;else h=t.flatten(n);this.children.push(new t.Scatter(i,e,o,h,s,r))},t.Axis.prototype.is2dim=function(){var t=this._zrange;return t[0]===t[1]},t.Axis.prototype.sensibleCameraUpVector=function(){return"orthographic"===this._projection?[0,1,0]:[0,0,1]},t.Axis.prototype.setupProjection=function(){var i,e,o,n,s,r,a,h=[],c=1/0,l=this,p=-1/0,u=1/0,d=-1/0,f=1/0;this._xrange=this.xLim(),this._yrange=this.yLim(),this._zrange=this.zLim(),this._crange=this.cLim(),this._xLim=t.prettyRange(this._xrange),this._yLim=t.prettyRange(this._yrange),this._zLim=t.prettyRange(this._zrange),this.cmap.cLim=t.prettyRange(this._crange),this.is2D=this.is2dim(),"auto"===this.xTickMode&&(this.xTick=t.ticks(this._xLim[0],this._xLim[1],5)),"auto"===this.xTickLabelMode&&(this.xTickLabel=this.xTick.map(this.xLabelFormat)),"auto"===this.yTickMode&&(this.yTick=t.ticks(this._yLim[0],this._yLim[1],5)),"auto"===this.yTickLabelMode&&(this.yTickLabel=this.yTick.map(this.yLabelFormat)),"auto"===this.zTickMode&&(this.zTick=t.ticks(this._zLim[0],this._zLim[1],5)),"auto"===this.zTickLabelMode&&(this.zTickLabel=this.zTick.map(this.zLabelFormat)),this.is2D||(this._projection="perspective"),this._CameraTarget=[(this._xLim[0]+this._xLim[1])/2,(this._yLim[0]+this._yLim[1])/2,(this._zLim[0]+this._zLim[1])/2],"auto"===this._CameraUpVectorMode&&(this._CameraUpVector=this.sensibleCameraUpVector()),"orthographic"===this._projection?(this._CameraUpVector=[0,1,0],"auto"===this._DataAspectRatioMode&&(this._DataAspectRatio=[(this._xLim[1]-this._xLim[0])/(this.w*this.fig.canvas.width),(this._yLim[1]-this._yLim[0])/(this.h*this.fig.canvas.height),1]),this._CameraPosition=[this._CameraTarget[0],this._CameraTarget[1],this._CameraTarget[2]+1]):("auto"===this._CameraPositionMode&&(this._CameraPosition=[-36.5257,-47.6012,86.6025],this._CameraPosition=[27.394,35.701,25.981],this._CameraPosition=[-36.5257,-47.6012,86.6025]),this._CameraViewAngle=10.339584907201978,"auto"===this._DataAspectRatioMode&&(this._DataAspectRatio=[this._xLim[1]-this._xLim[0],this._yLim[1]-this._yLim[0],this._zLim[1]-this._zLim[0]],this._DataAspectRatio=numeric.div(this._DataAspectRatio,Math.min.apply(null,this._DataAspectRatio))));var tr=function(t){var i,e=numeric.div(t,l._DataAspectRatio);return[(i=l._transform[0]([e[0],e[1],e[2],1]))[0],i[1],i[2]]};this.modelView=numeric.dot(t.LookAt(tr(this._CameraPosition),tr(this._CameraTarget),this._CameraUpVector),numeric.inv(t.scale(this._DataAspectRatio)));var m=tr(this._CameraTarget);for(console.log("modelView * transformed camera Target",numeric.dot(this.modelView,[m[0],m[1],m[2],1])),"orthographic"===this._projection?this.projection=numeric.identity(4):this.projection=t.perspective(this._CameraViewAngle*Math.PI/180,1,-10,200),this.projectionModelView=numeric.dot(this.projection,this.modelView),p=-1/0,u=1/0,d=-1/0,f=1/0,1/0,-1/0,n=[],h=[],i=0;i<2;i++)for(n[i]=[],h[i]=[],e=0;e<2;e++)for(n[i][e]=[],h[i][e]=[],o=0;o<2;o++)n[i][e][o]=[this._xLim[i],this._yLim[e],this._zLim[o],1],a=this.project(n[i][e][o],{viewport:numeric.identity(4)}),u=Math.min(u,a[0]),p=Math.max(p,a[0]),d=Math.max(d,a[1]),f=Math.min(f,a[1]),h[i][e][o]=a,a[2]<c&&(c=a[2],s=[i,e,o]);this.behindind=s,r=Math.min(this.fig.canvas.width*this.w/(p-u),this.fig.canvas.height*this.h/(d-f)),this.viewport=t.prod(t.translate([this.fig.canvas.width*(this.x+this.w/2),this.fig.canvas.height*(1-this.y-this.h/2),0]),t.scale([r,-r,1])),this.invViewport=numeric.inv(this.viewport),this.invProjectionModelView=numeric.inv(this.projectionModelView),this.lr=numeric.dot(this.viewport,[p,f,0,1]),this.ul=numeric.dot(this.viewport,[u,d,0,1])},t.Axis.prototype.renderElements=function(){var t,i;for(t=0;t<this.renderedElements.length;t++)this.renderedElements[t].order=t;for(this.renderedElements.sort((function(t,i){var e=t.zIndex-i.zIndex;return 0!==e?e:t.order-i.order})),t=0;t<this.renderedElements.length;t++)(i=this.renderedElements[t]).fun.apply(this.fig.canvas,i.args);this.renderedElements=[]},t.Axis.prototype.draw=function(){var t,i;for(this.setupProjection(),this.renderedElements=[],console.log("project ",this.project([25.5,-.3,0])),this.is2D||(this.drawAxis(0,this.xTickLabel,this.xTickLen),this.drawAxis(1,this.yTickLabel,this.yTickLen),this.drawAxis(2,this.zTickLabel,this.zTickLen)),this.fig.canvas.clipRect(this.ul[0],this.ul[1],this.lr[0]-this.ul[0],this.lr[1]-this.ul[1]),t=0;t<this.children.length;t++)this.children[t].draw(this);for(this.renderElements(),t=0;t<this._annotations.length;t++)i=this._annotations[t],this.drawAnnotation(i.x,i.y,i.z,i.text,i.style);this.fig.canvas.exitClipRect(),this.is2D&&(this.drawAxis(0,this.xTickLabel,this.xTickLen,{position:this.xAxisLocation,box:!0}),this.drawAxis(1,this.yTickLabel,this.yTickLen,{position:this.yAxisLocation,box:!0})),this._legend&&this.drawLegend(),this.renderElements()},t.Axis.prototype.drawAxis=function(t,i,e,o){var n,s;this.behindind,this._xLim,this._yLim,this._zLim;function cshift(t,i){return 0===(i=function mod(t,i){return(t%i+i)%i}(i,t.length))?t:1===i?[t[1],t[2],t[0]]:cshift(cshift(t,1),i-1)}n=cshift([this._xLim,this._yLim,this._zLim],t),this._xLim=n[0],this._yLim=n[1],this._zLim=n[2],n=cshift([this.xTick,this.yTick,this.zTick],t),this.xTick=n[0],this.yTick=n[1],this.zTick=n[2],s=this.project,this.behindind=cshift(this.behindind,t),this.project=function(i,e){return s.call(this,cshift(i,-t),e)},this.drawAxisX(i,e,o),this.project=s,this.behindind=cshift(this.behindind,-t),n=cshift([this._xLim,this._yLim,this._zLim],-t),this._xLim=n[0],this._yLim=n[1],this._zLim=n[2],n=cshift([this.xTick,this.yTick,this.zTick],-t),this.xTick=n[0],this.yTick=n[1],this.zTick=n[2]},t.Axis.prototype.drawAxisX=function(t,i,e){var o,n,s,r,a,h,c,l,p,u,d,f,m,y,g,x,v,L,_=1/0,k=this.behindind;for(x=(e=e||{}).ticksRefDir||[1,1],L=void 0!==e.box&&e.box,"bottom"===(v=e.position)?x=[0,1]:"top"===v?x=[0,-1]:"right"===v?x=[-1,0]:"left"===v&&(x=[1,0]),u=k[2],p=0;p<this.yTick.length;p++)this.drawLine(this._xLim,[this.yTick[p],this.yTick[p]],[this._zLim[u],this._zLim[u]],{linespec:this.gridLineStyle});for(p=k[1],u=0;u<this.zTick.length;u++)this.drawLine(this._xLim,[this._yLim[p],this._yLim[p]],[this.zTick[u],this.zTick[u]],{linespec:this.gridLineStyle});for(p=0;p<2;p++)for(u=0;u<2;u++)k[1]===p!=(k[2]===u)&&(s=this.project([this._xLim[0],this._yLim[p],this._zLim[u]],{viewport:numeric.identity(4)}),r=this.project([this._xLim[1],this._yLim[p],this._zLim[u]],{viewport:numeric.identity(4)}),(o=(d=[(s[0]+r[0])/2,(s[1]+r[1])/2])[0]*x[0]+d[1]*x[1])<_&&(_=o,n=[p,u],c=Math.abs(r[0]-s[0])>Math.abs(r[1]-s[1])?{HorizontalAlignment:"center",VerticalAlignment:x[1]>0?"top":"bottom"}:{HorizontalAlignment:x[0]>0?"right":"left",VerticalAlignment:"middle"}));if(L)for(p=0;p<2;p++)for(u=0;u<2;u++)this.drawLine(this._xLim,[this._yLim[p],this._yLim[p]],[this._zLim[u],this._zLim[u]]);else p=n[0],u=n[1];for(p=n[0],u=n[1],l=0;l<this.xTick.length;l++)s=this.project([this.xTick[l],this._yLim[p],this._zLim[u]]),a=this.project([this.xTick[l],this._yLim[p]+1,this._zLim[u]]),y=Math.pow(a[0]-s[0],2)+Math.pow(a[1]-s[1],2),h=this.project([this.xTick[l],this._yLim[p],this._zLim[u]+1]),g=Math.pow(h[0]-s[0],2)+Math.pow(h[1]-s[1],2),y>0&&(p!==k[1]||0===g)?(f=i/(2*Math.sqrt(y)),this.drawLine([this.xTick[l],this.xTick[l]],[this._yLim[p]-f,this._yLim[p]+f],[this._zLim[u],this._zLim[u]]),this.text(this.xTick[l],this._yLim[p]+2*(0===p?-1:1)*f,this._zLim[u],t[l],c)):g>0?(m=i/(2*Math.sqrt(g)),this.drawLine([this.xTick[l],this.xTick[l]],[this._yLim[p],this._yLim[p]],[this._zLim[u]-m,this._zLim[u]+m])):console.warn("Cannot determine orientation of ticks")},t.Axis.prototype.legend=function(t){t=void 0===t||t,this._legend=t},t.Axis.prototype.drawLegend=function(){var t,i,e,o,n,s,r,a,h=-1/0,c=-1/0,l=0,p=0;for(s=0;s<this.children.length;s++)void 0!==(i=(t=this.children[s].style).label)&&""!==i&&(e=this.fig.canvas.textBBox(i),h=Math.max(h,e.width),c=Math.max(c,e.height),void 0!==t.markerSize&&(l=Math.max(l,t.markerSize)),p+=1);for(r=h+14+25+5+2*l,a=p*(c+1)+14,o=this.fig.canvas.width*(this.x+this.w)-10-r,n=this.fig.canvas.height*(1-this.y-this.h)+10,this.fig.canvas.rect(o,n,r,a,{fill:"white",stroke:"black"}),o+=7,n=n+7+c/2,s=0;s<this.children.length;s++)void 0!==(i=(t=this.children[s].style).label)&&""!==i&&(this.drawProjectedLine([o+l,o+l+25],[n,n],[this.legendZIndex,this.legendZIndex],t),this.fig.canvas.text(o+2*l+25+5,n,i,{VerticalAlignment:"middle"}),n=n+c+1)},t.Axis.prototype.rect=function(t,i,e){var o,n,s;n=this.project([t[0],i[1]]),s=this.project([t[1],i[0]]),o="string"==typeof e?e:this.cmap.get(e),this.fig.canvas.rect(n[0],n[1],s[0]-n[0],s[1]-n[1],{fill:o,stroke:o})},t.Axis.prototype.text=function(t,i,e,o,n){var s;s=this.project([t,i,e]),this.fig.canvas.text(s[0],s[1],o,n)},t.Axis.prototype.polygon=function(t,i,e,o,n){var s,r,a,h=[],c=[],l=[],p=this;for(r=0;r<t.length;r++)s=this.project([t[r],i[r],e[r]]),h.push(s[0]),c.push(s[1]),l.push(s[2]);n=n||this.cmap.get(o),a=function(n){var s,r,a=p.annotationNDigits;r=(r=p.is2dim()?[t[0],i[0]]:[t[0],i[0],e[0]]).map((function(t){return t.toFixed(a)})),s=o.toFixed(a)+" at ["+r+"]",p.toggleAnnotation(n,n.target,t[0],i[0],e[0],s)},this.renderedElements.push({zIndex:Math.min.apply(null,l),fun:this.fig.canvas.polygon,args:[h,c,{fill:n,stroke:n,onclick:a}]})},t.Axis.prototype.annotation=function(t,i,e,o,n){this._annotations.push({x:t,y:i,z:e,text:o,style:n})},t.Axis.prototype.drawAnnotation=function(t,i,e,o,n){var s,r,a,h,c,l,p,u,d={},f=this;return void 0===(n=n||{}).onclick&&(n.onclick=function(t){f.removeAnnotation(d)}),r=this.project([t,i,e]),s=this.fig.canvas.textBBox(o),a=r[0],h=r[1],c=s.width+8,l=s.height+8,u=this.fig.canvas.currentLayer(),p=this.fig.canvas.newLayer(),this.fig.canvas.clipRect(this.ul[0],this.ul[1],this.lr[0]-this.ul[0],this.lr[1]-this.ul[1]),d.layer=p,d.rect=this.fig.canvas.rect(a,h,c,l,{fill:n.fill||"#ffc",onclick:n.onclick}),a+=4,h+=4,d.text=this.fig.canvas.text(a,h,o,{VerticalAlignment:"top",onclick:n.onclick}),this.fig.canvas.exitClipRect(),this.fig.canvas.currentLayer(u),d},t.Axis.prototype.removeAnnotation=function(t){this.fig.canvas.removeLayer(t.layer)},t.Axis.prototype.toggleAnnotation=function(t,i,e,o,n,s){var r,a,h=-1,c=this;this.annotationNDigits;for(s||(s="["+(this.is2dim()?[e,o]:[e,o,n]).map((function(t){return c.annotationFormat(t)}))+"]"),a=0;a<this.annotatedElements.length;a++)if(this.annotatedElements[a].elem===i){h=a;break}if(-1!==h)r=this.annotatedElements[h],this.removeAnnotation(r),this.annotatedElements.splice(h,1);else{var onclick=function(t){c.toggleAnnotation(t,i,e,o,n,{onclick:onclick})};(r=this.drawAnnotation(e,o,n,s,{onclick:onclick})).elem=i,this.annotatedElements.push(r)}},t.Axis.prototype.drawLine=function(t,i,e,o){var n,s,r=[],a=[],h=[];for(o=o||{},s=0;s<t.length;s++)n=isNaN(t[s])||isNaN(i[s])||isNaN(e[s])?[NaN,NaN,NaN]:this.project([t[s],i[s],e[s]]),r.push(n[0]),a.push(n[1]),h.push(n[2]);this.drawProjectedLine(r,a,h,o,t,i,e)},t.Axis.prototype.drawProjectedLine=function(i,e,o,n,s,r,a){var h,c,l={},p=this,u=[],d=[],f=[];for(n=n||{},h=0;h<i.length;h++)isNaN(i[h])||isNaN(e[h])?u.length>0&&(this.renderedElements.push({zIndex:Math.min.apply(null,f),fun:this.fig.canvas.line,args:[t.clone(u),t.clone(d),t.clone(n)]}),u=[],d=[],f=[]):(u.push(i[h]),d.push(e[h]),f.push(o[h]));for(this.renderedElements.push({zIndex:Math.min.apply(null,f),fun:this.fig.canvas.line,args:[t.clone(u),t.clone(d),t.clone(n)]}),h=0;h<i.length;h++)isNaN(i[h])||isNaN(e[h])||(s&&(l.data=[s[h],r[h]],l["pointer-events"]="visible",l.onclick=function(t){return function(i){p.toggleAnnotation(i,i.target,s[t],r[t],a[t])}}(h)),c=n.markerSize||7,"o"===n.marker?(l.fill=n.MarkerFaceColor,l.stroke=n.MarkerEdgeColor||n.color,this.fig.canvas.circle(i[h],e[h],c,l)):"s"===n.marker&&(l.fill=n.MarkerFaceColor,l.stroke=n.MarkerEdgeColor||n.color,this.fig.canvas.rect(i[h]-c/2,e[h]-c/2,c,c,l)))},t.Axis.prototype.colorbar=function(){var i,e,o,n,s,r,a,h=20,c=30,l=40;for(r=2*(h/=this.fig.canvas.width)+(c/=this.fig.canvas.width)+(l/=this.fig.canvas.width),1-this.x-this.w<r&&(this.w=1-this.x-r),(i=this.fig.axes(1-(h+c+l),.1,c,.8)).yAxisLocation="right",i.xTickMode="manual",i.xTick=[],e=this.cLim(),[a=t.range(e[0],e[1],(e[1]-e[0])/63),a],n=[[],[]],s=[[],[]],o=0;o<64;o++)s[0][o]=e[0]+o*(e[1]-e[0])/63,s[1][o]=s[0][o],n[0][o]=0,n[1][o]=1;return i.pcolor(n,s,s),i},t.Figure=function Figure(i,e,o,n){var s,r=this;if(s=void 0!==(n=n||{}).renderer?n.renderer:t.SVGCanvas,this.container=document.getElementById(i),!t.supportsSVG())throw this.container.appendChild(t.mk("","div",{style:{width:e+"px",height:o+"px",border:"1px solid red","font-size":"large"}},[t.mk("","div",{style:{margin:"2em"}},[t.mk("","h3",{style:{color:"red"}},["Your web browser does not support Scalable Vector Graphics (SVG)."]),t.mk("","p",{},["Old versions of Internet Explorer (version 8 and before) do unfortunately not understand the SVG standard."]),"To see the graphics on this web-page you either need to upgrade your version of Internet Explorer (to version 9 or later) ","or install a more standard compilant browser such as ",t.mk("","a",{href:"http://www.mozilla.org/"},["Mozilla Firefox"])," or ",t.mk("","a",{href:"http://www.google.com/chrome/"},["Google Chrome"]),"."])])),"Error: SVG support is not detected";function getcoord(t){return[t.pageX-r.container.offsetLeft,t.pageY-r.container.offsetTop]}function getcoordp(t){var i,e,o;return i=t.pageX-r.container.offsetLeft,e=t.pageY-r.container.offsetTop,o=r._axes[0].unproject([i,e]),console.log("getcoordp v",o),[o[0],o[1]]}this.outerDIV=t.html("div",{style:{position:"relative","user-select":"none","-webkit-user-select":"none"}}),this.outerDIV.appendChild(this.zoomrect=t.html("div",{class:"matplot-zoomrect",style:{position:"absolute",display:"none",width:"0px",height:"0px",border:"1px solid black",left:"0px",top:"0px"}})),this.canvas=new s(this.outerDIV,e,o),this.outerDIV.appendChild(this.contextmenu=t.html("div",{class:"matplot-contextmenu",style:{position:"absolute",display:"none",left:"0px",top:"0px"}},[t.html("ul",{},[t.html("li",{},[t.html("a",{href:"#",onclick:function(t){return r.save(this)},download:"figure"},["Download"])]),t.html("li",{},[t.html("a",{href:"#",onclick:function(t){return r.zoom(-6,t.pageX,t.pageY)}},["Zoom in"])]),t.html("li",{},[t.html("a",{href:"#",onclick:function(t){return r.zoom(6,t.pageX,t.pageY)}},["Zoom out"])]),t.html("li",{},[t.html("a",{href:"#",onclick:function(t){return r.resetZoom()}},["Reset zoom"])])])])),this.container.appendChild(this.outerDIV),this._axes=[],this.canvas.elem&&window.addWheelListener(this.canvas.elem,(function(t){r.zoom(t.deltaY,t.pageX,t.pageY)||t.preventDefault()})),this.position1=null,this.position2=null,this.dragMode="panning",this.dragMode="zooming",this.canvas.elem.addEventListener("mousedown",(function(t){var i,e;console.log("mousedown ",t),"block"===r.contextmenu.style.display&&(r.contextmenu.style.display="none"),0===t.button&&(r.position1=t,r.po=getcoordp(r.position1),i=r._axes[0],r.orig_xlim=i.xLim(),console.log("that.position1",r.position1),e=getcoord(r.position1),r.zoomrect.style.left=e[0]+"px",r.zoomrect.style.top=e[1]+"px",r.zoomrect.style.width="0px",r.zoomrect.style.height="0px")})),this.outerDIV.addEventListener("mouseup",(function(t){var i,e,o;"block"===r.zoomrect.style.display&&(r.zoomrect.style.display="none"),null!==r.position1&&null!==r.position2&&(i=getcoordp(r.position1),e=getcoordp(r.position2),"zooming"===r.dragMode&&((o=r._axes[0]).xLim([Math.min(i[0],e[0]),Math.max(i[0],e[0])]),o.yLim([Math.min(i[1],e[1]),Math.max(i[1],e[1])]),r.draw())),r.position1=null,r.position2=null}),!1),this.outerDIV.addEventListener("mousemove",(function(t){var i,e,o,n,s,a,h,c,l;r.position1&&(r.position2=t,"zooming"===r.dragMode?(i=getcoord(r.position1),e=getcoord(r.position2),o=Math.min(i[0],e[0]),a=Math.abs(e[0]-i[0]),n=Math.min(i[1],e[1]),s=Math.abs(e[1]-i[1]),r.zoomrect.style.display="block",r.zoomrect.style.left=o+"px",r.zoomrect.style.top=n+"px",r.zoomrect.style.width=a+"px",r.zoomrect.style.height=s+"px"):(getcoordp(r.position1),i=getcoordp(t),(h=r._axes[0]).xLim(),l=i[0]-r.po[0],c=[r.orig_xlim[0]-l,r.orig_xlim[1]-l],h.xLim(c),r.draw()))})),this.outerDIV.addEventListener("contextmenu",(function(t){var i,e;i=t.pageX-r.container.offsetLeft,e=t.pageY-r.container.offsetTop,r.contextmenu.style.display="block",r.contextmenu.style.left=i+"px",r.contextmenu.style.top=e+"px",t.preventDefault()}))},t.Figure.prototype.closeContextmenu=function(){this.contextmenu.style.display="none"},t.Figure.prototype.axes=function(i,e,o,n){var s;return i=void 0!==i?i:.1,e=void 0!==e?e:.1,o=void 0!==o?o:.8,n=void 0!==n?n:.8,s=new t.Axis(this,i,e,o,n),this._axes.push(s),s},t.Figure.prototype.clear=function(){this.canvas.clear()},t._dataURLtoBlob=function(t){for(var i=t.match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/),e=atob(i[3]),o=new ArrayBuffer(e.length),n=new Uint8Array(o),s=0;s<n.length;s++)n[s]=e.charCodeAt(s);return new Blob([n],{type:i[1]})},t.Figure.prototype.save=function(i){var e=this;return this.canvas.serialize((function(i){if(e.closeContextmenu(),navigator.msSaveBlob)i.dataURL&&(i.data=t._dataURLtoBlob(i.dataURL)),console.log("retval ",navigator.msSaveBlob(i.data,i.download));else{var o=document.createElement("a");if(void 0!==o.download){i.data?o.href=URL.createObjectURL(i.data):o.href=i.dataURL,o.download=i.download,console.log("fig.data ",i.data);var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),o.dispatchEvent(n)}else alert("Your browser does not support downloading. Try the Firefox, Chrome or Internet Explorer 11")}})),!1},t.Figure.prototype.resetZoom=function(){var t;(t=this._axes[0]).xLimMode("auto"),t.yLimMode("auto"),this.draw(),this.closeContextmenu()},t.Figure.prototype.zoom=function(t,i,e){var o,n,s,r,a;return o=i-this.container.offsetLeft,n=e-this.container.offsetTop,s=o/this.canvas.width,r=1-n/this.canvas.height,!((a=this._axes[0]).x<=s&&s<=a.x+a.w&&a.y<=r&&r<=a.y+a.h)||(a.zoom(t,i,e),!1)},t.Figure.prototype.draw=function(t,i){var e;for(this.clear(),e=0;e<this._axes.length;e++)this._axes[e]._yLim=[t,i],this._axes[e].draw()},t}();pc.script.createLoadingScreen((function(e){var t,a;t=["html {","    -webkit-text-size-adjust: none;","    touch-action: pan-y;","}","body {","    background-color: #1b1b1b;","}","#application-splash-wrapper {","    position: absolute;","    top: 0;","    left: 0;","    height: 100%;","    width: 100%;","    background-color: #1b1b1b;","}","#application-splash {","    position: absolute;","    top: calc(50% - 28px);","    width: 264px;","    left: calc(50% - 132px);","}","#application-splash img {","    width: 100%;","}","#progress-bar-container {","    margin: 20px auto 0 auto;","    height: 2px;","    width: 100%;","    background-color: #1d292c;","}","#progress-bar {","    width: 0%;","    height: 100%;","    background-color: #0dfcb2;","}","@media (max-width: 480px) {","    #application-splash {","        width: 170px;","        left: calc(50% - 85px);","    }","}"].join("\n"),(a=document.createElement("style")).type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t)),document.head.appendChild(a),function(){window.addEventListener("wheel",(e=>{e.preventDefault()}),{passive:!1});var e=document.createElement("div");e.id="application-splash-wrapper",document.body.appendChild(e);var t=document.createElement("div");t.id="application-splash",e.appendChild(t),t.style.display="none";var a=document.createElement("img");a.src="https://d148xrjotn7dtb.cloudfront.net/FS_logo.png",t.appendChild(a),a.onload=function(){t.style.display="block"};var n=document.createElement("div");n.id="progress-bar-container",t.appendChild(n);var o=document.createElement("div");o.id="progress-bar",n.appendChild(o)}(),e.on("preload:end",(function(){e.off("preload:progress")})),e.on("preload:progress",(function(e){var t=document.getElementById("progress-bar");t&&(e=Math.min(1,Math.max(0,e)),t.style.width=100*e+"%")})),e.on("start",(function(){var e=document.getElementById("application-splash-wrapper");e.parentElement.removeChild(e)}))}));var Pulse=pc.createScript("pulse");Pulse.attributes.add("startingEvent",{title:"Event",type:"string"}),Pulse.attributes.add("loop",{title:"Loop",type:"boolean",default:!1}),Pulse.attributes.add("duration",{type:"number",default:.1,description:"Tween animation duration"}),Pulse.attributes.add("scaleincrement",{type:"number",default:1,description:"Amout of scaling on pulse animation"}),Pulse.prototype.initialize=function(){this.isRunning=!1,this.app.on(this.startingEvent,(function(){this.pulse()}),this)},Pulse.prototype.pulse=function(){var t=this;if(!this.isRunning){this.isRunning=!0;var e=this.entity.getLocalScale().clone(),i=this.entity.tween(this.entity.getLocalScale()).to({x:e.x+this.scaleincrement,y:e.y+this.scaleincrement,z:e.z+this.scaleincrement},this.duration,pc.SineInOut);this.loop?i.loop(!0).yoyo(!0):i.yoyo(!0).repeat(2).on("complete",(function(){t.isRunning=!1})),i.start()}};var _Group=function(){this._tweens={},this._tweensAddedDuringUpdate={}};_Group.prototype={getAll:function(){return Object.keys(this._tweens).map(function(t){return this._tweens[t]}.bind(this))},removeAll:function(){this._tweens={}},add:function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},remove:function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},update:function(t,n){var e=Object.keys(this._tweens);if(0===e.length)return!1;for(t=void 0!==t?t:TWEEN.now();e.length>0;){this._tweensAddedDuringUpdate={};for(var i=0;i<e.length;i++){var r=this._tweens[e[i]];r&&!1===r.update(t)&&(r._isPlaying=!1,n||delete this._tweens[e[i]])}e=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var TWEEN=new _Group;TWEEN.Group=_Group,TWEEN._nextId=0,TWEEN.nextId=function(){return TWEEN._nextId++},"undefined"==typeof self&&"undefined"!=typeof process&&process.hrtime?TWEEN.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?TWEEN.now=self.performance.now.bind(self.performance):void 0!==Date.now?TWEEN.now=Date.now:TWEEN.now=function(){return(new Date).getTime()},TWEEN.Tween=function(t,n){this._object=t,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=TWEEN.Easing.Linear.None,this._interpolationFunction=TWEEN.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onRepeatCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=n||TWEEN,this._id=TWEEN.nextId()},TWEEN.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(t,n){return this._valuesEnd=Object.create(t),void 0!==n&&(this._duration=n),this},duration:function duration(t){return this._duration=t,this},start:function(t){for(var n in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==t?"string"==typeof t?TWEEN.now()+parseFloat(t):t:TWEEN.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[n]instanceof Array){if(0===this._valuesEnd[n].length)continue;this._valuesEnd[n]=[this._object[n]].concat(this._valuesEnd[n])}void 0!==this._object[n]&&(this._valuesStart[n]=this._object[n],this._valuesStart[n]instanceof Array==!1&&(this._valuesStart[n]*=1),this._valuesStartRepeat[n]=this._valuesStart[n]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(1/0),this},stopChainedTweens:function(){for(var t=0,n=this._chainedTweens.length;t<n;t++)this._chainedTweens[t].stop()},group:function(t){return this._group=t,this},delay:function(t){return this._delayTime=t,this},repeat:function(t){return this._repeat=t,this},repeatDelay:function(t){return this._repeatDelayTime=t,this},yoyo:function(t){return this._yoyo=t,this},easing:function(t){return this._easingFunction=t,this},interpolation:function(t){return this._interpolationFunction=t,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(t){return this._onStartCallback=t,this},onUpdate:function(t){return this._onUpdateCallback=t,this},onRepeat:function onRepeat(t){return this._onRepeatCallback=t,this},onComplete:function(t){return this._onCompleteCallback=t,this},onStop:function(t){return this._onStopCallback=t,this},update:function(t){var n,e,i;if(t<this._startTime)return!0;for(n in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),e=(t-this._startTime)/this._duration,e=0===this._duration||e>1?1:e,i=this._easingFunction(e),this._valuesEnd)if(void 0!==this._valuesStart[n]){var r=this._valuesStart[n]||0,a=this._valuesEnd[n];a instanceof Array?this._object[n]=this._interpolationFunction(a,i):("string"==typeof a&&(a="+"===a.charAt(0)||"-"===a.charAt(0)?r+parseFloat(a):parseFloat(a)),"number"==typeof a&&(this._object[n]=r+(a-r)*i))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object,e),1===e){if(this._repeat>0){for(n in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[n]&&(this._valuesStartRepeat[n]=this._valuesStartRepeat[n]+parseFloat(this._valuesEnd[n])),this._yoyo){var s=this._valuesStartRepeat[n];this._valuesStartRepeat[n]=this._valuesEnd[n],this._valuesEnd[n]=s}this._valuesStart[n]=this._valuesStartRepeat[n]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,null!==this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var o=0,u=this._chainedTweens.length;o<u;o++)this._chainedTweens[o].start(this._startTime+this._duration);return!1}return!0}},TWEEN.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var n=1.70158;return t*t*((n+1)*t-n)},Out:function(t){var n=1.70158;return--t*t*((n+1)*t+n)+1},InOut:function(t){var n=2.5949095;return(t*=2)<1?t*t*((n+1)*t-n)*.5:.5*((t-=2)*t*((n+1)*t+n)+2)}},Bounce:{In:function(t){return 1-TWEEN.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*TWEEN.Easing.Bounce.In(2*t):.5*TWEEN.Easing.Bounce.Out(2*t-1)+.5}}},TWEEN.Interpolation={Linear:function(t,n){var e=t.length-1,i=e*n,r=Math.floor(i),a=TWEEN.Interpolation.Utils.Linear;return n<0?a(t[0],t[1],i):n>1?a(t[e],t[e-1],e-i):a(t[r],t[r+1>e?e:r+1],i-r)},Bezier:function(t,n){for(var e=0,i=t.length-1,r=Math.pow,a=TWEEN.Interpolation.Utils.Bernstein,s=0;s<=i;s++)e+=r(1-n,i-s)*r(n,s)*t[s]*a(i,s);return e},CatmullRom:function(t,n){var e=t.length-1,i=e*n,r=Math.floor(i),a=TWEEN.Interpolation.Utils.CatmullRom;return t[0]===t[e]?(n<0&&(r=Math.floor(i=e*(1+n))),a(t[(r-1+e)%e],t[r],t[(r+1)%e],t[(r+2)%e],i-r)):n<0?t[0]-(a(t[0],t[0],t[1],t[1],-i)-t[0]):n>1?t[e]-(a(t[e],t[e],t[e-1],t[e-1],i-e)-t[e]):a(t[r?r-1:0],t[r],t[e<r+1?e:r+1],t[e<r+2?e:r+2],i-r)},Utils:{Linear:function(t,n,e){return(n-t)*e+t},Bernstein:function(t,n){var e=TWEEN.Interpolation.Utils.Factorial;return e(t)/e(n)/e(t-n)},Factorial:function(){var t=[1];return function(n){var e=1;if(t[n])return t[n];for(var i=n;i>1;i--)e*=i;return t[n]=e,e}}(),CatmullRom:function(t,n,e,i,r){var a=.5*(e-t),s=.5*(i-n),o=r*r;return(2*n-2*e+a+s)*(r*o)+(-3*n+3*e-2*a-s)*o+a*r+n}}},function(t){"function"==typeof define&&define.amd?define([],(function(){return TWEEN})):"undefined"!=typeof module&&"object"==typeof exports?module.exports=TWEEN:void 0!==t&&(t.TWEEN=TWEEN)}(this);var Tweener=pc.createScript("tweener");Tweener.attributes.add("event",{title:"Event",type:"string"}),Tweener.attributes.add("duration",{title:"Duration",type:"number",default:1e3}),Tweener.attributes.add("easingFunction",{title:"Easing Function",type:"number",enum:[{Linear:0},{Quadratic:1},{Cubic:2},{Quartic:3},{Quintic:4},{Sinusoidal:5},{Exponential:6},{Circular:7},{Elastic:8},{Back:9},{Bounce:10}]}),Tweener.attributes.add("easingType",{title:"Easing Type",type:"number",enum:[{In:0},{Out:1},{InOut:2}]}),Tweener.attributes.add("delay",{title:"Delay",type:"number",default:0}),Tweener.attributes.add("repeat",{title:"Repeat",type:"number",default:0}),Tweener.attributes.add("repeatDelay",{title:"Repeat Delay",type:"number",default:0}),Tweener.attributes.add("yoyo",{title:"Yoyo",type:"boolean",default:!1}),Tweener.attributes.add("startPos",{title:"Start Pos",type:"vec3",default:[0,0,0]}),Tweener.attributes.add("endPos",{title:"End Pos",type:"vec3",default:[0,0,0]}),Tweener.attributes.add("startRot",{title:"Start Rot",type:"vec3",default:[0,0,0]}),Tweener.attributes.add("endRot",{title:"End Rot",type:"vec3",default:[0,0,0]}),Tweener.attributes.add("startScale",{title:"Start Scale",type:"vec3",default:[1,1,1]}),Tweener.attributes.add("endScale",{title:"End Scale",type:"vec3",default:[1,1,1]}),Tweener.attributes.add("startEvent",{title:"Start Event",type:"string"}),Tweener.attributes.add("stopEvent",{title:"Stop Event",type:"string"}),Tweener.attributes.add("updateEvent",{title:"Update Event",type:"string"}),Tweener.attributes.add("completeEvent",{title:"Complete Event",type:"string"}),Tweener.attributes.add("repeatEvent",{title:"Repeat Event",type:"string"}),Tweener.prototype.initialize=function(){var t=this.app;this.initialPos=this.entity.getPosition().clone(),this.initialScl=this.entity.getLocalScale().clone(),this.initialRot=this.entity.getLocalEulerAngles().clone(),this.tween=null,t.on(this.event,(function(){this.start()}),this),this.on("enable",(function(){this.entity.setPosition(this.initialPos),this.entity.setLocalScale(this.initialScl),this.entity.setLocalEulerAngles(this.initialRot)})),this.on("attr",(function(t,e,i){this.start()}))},Tweener.prototype.start=function(){var t,e=this.app,i=["Linear","Quadratic","Cubic","Quartic","Quintic","Sinusoidal","Exponential","Circular","Elastic","Back","Bounce"];t=0===this.easingFunction?TWEEN.Easing[i[this.easingFunction]].None:TWEEN.Easing[i[this.easingFunction]][["In","Out","InOut"][this.easingType]],this.tween&&this.tween.stop();var n={px:this.startPos.x,py:this.startPos.y,pz:this.startPos.z,sx:this.startScale.x,sy:this.startScale.y,sz:this.startScale.z,rx:this.startRot.x,ry:this.startRot.y,rz:this.startRot.z},a={px:this.endPos.x,py:this.endPos.y,pz:this.endPos.z,sx:this.endScale.x,sy:this.endScale.y,sz:this.endScale.z,rx:this.endRot.x,ry:this.endRot.y,rz:this.endRot.z},s=this.entity;this.tween=new TWEEN.Tween(n).to(a,this.duration).easing(t).onStart(function(t){""!==this.startEvent&&e.fire(this.startEvent)}.bind(this)).onStop(function(t){""!==this.stopEvent&&e.fire(this.stopEvent)}.bind(this)).onUpdate(function(t){s.setPosition(t.px,t.py,t.pz),s.setLocalScale(t.sx,t.sy,t.sz),s.setEulerAngles(t.rx,t.ry,t.rz),""!==this.updateEvent&&e.fire(this.updateEvent)}.bind(this)).onComplete(function(t){""!==this.completeEvent&&e.fire(this.completeEvent)}.bind(this)).onRepeat(function(t){""!==this.repeatEvent&&e.fire(this.repeatEvent)}.bind(this)).repeat(this.repeat).repeatDelay(this.repeatDelay).yoyo(this.yoyo).delay(this.delay).start()};pc.extend(pc,function(){var TweenManager=function(t){this._app=t,this._tweens=[],this._add=[]};TweenManager.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var i=0,e=this._tweens.length;i<e;)this._tweens[i].update(t)?i++:(this._tweens.splice(i,1),e--);this._add.length&&(this._tweens=this._tweens.concat(this._add),this._add.length=0)}};var Tween=function(t,i,e){pc.events.attach(this),this.manager=i,e&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.Linear,this._sv={},this._ev={}},_parseProperties=function(t){var i;return t instanceof pc.Vec2?i={x:t.x,y:t.y}:t instanceof pc.Vec3?i={x:t.x,y:t.y,z:t.z}:t instanceof pc.Vec4||t instanceof pc.Quat?i={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Color?(i={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(i.a=t.a)):i=t,i};Tween.prototype={to:function(t,i,e,n,s,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),n&&this.delay(n),s&&this.repeat(s),r&&this.yoyo(r),this},from:function(t,i,e,n,s,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),n&&this.delay(n),s&&this.repeat(s),r&&this.yoyo(r),this._from=!0,this},rotate:function(t,i,e,n,s,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),n&&this.delay(n),s&&this.repeat(s),r&&this.yoyo(r),this._slerp=!0,this},start:function(){var t,i,e,n;if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this._properties[t],this._ev[t]=this.target[t]);this._slerp&&(this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,n=void 0!==this._properties.z?this._properties.z:this.target.z,this._fromQuat.setFromEulerAngles(i,e,n))}else{for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this.target[t],this._ev[t]=this._properties[t]);this._slerp&&(this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,n=void 0!==this._properties.z?this._properties.z:this.target.z,this._toQuat.setFromEulerAngles(i,e,n))}return this._currentDelay=this._delay,this.manager.add(this),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,i){return this._count=0,this._numRepeats=t,this._repeatDelay=i||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time=this.time-this._currentDelay,this.pending=!1}var i=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(i=this.duration-this.time,this.time=0):(i=this.time-this.duration,this.time=this.duration));var e,n,s=this.time/this.duration,r=this.easing(s);for(var h in this._properties)this._properties.hasOwnProperty(h)&&(e=this._sv[h],n=this._ev[h],this.target[h]=e+(n-e)*r);if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,r),this.entity&&(this.entity._dirtifyLocal(),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var a=this._repeat(i);return a?this.fire("loop"):(this.fire("complete",i),this.entity&&this.entity.off("destroy",this.stop,this),this._chained&&this._chained.start()),a}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var i in this._properties){var e=this._sv[i];this._sv[i]=this._ev[i],this._ev[i]=e}this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var BounceIn=function(t){return 1-BounceOut(1-t)},BounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375};return{TweenManager:TweenManager,Tween:Tween,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},BackOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},BackInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},BounceIn:BounceIn,BounceOut:BounceOut,BounceInOut:function(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5},ElasticIn:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},ElasticOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var i,e=.1,n=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=n*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/n)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/n)*.5+1)}}}()),function(){pc.Application.prototype.addTweenManager=function(){this._tweenManager=new pc.TweenManager(this),this.on("update",(function(t){this._tweenManager.update(t)}))},pc.Application.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,i){var e=this._app.tween(t);return e.entity=this,this.once("destroy",e.stop,e),i&&i.element&&(e.element=i.element),e};var t=pc.Application.getApplication();t&&t.addTweenManager()}();

//# sourceMappingURL=__game-scripts.js.map